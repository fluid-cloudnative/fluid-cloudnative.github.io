<!DOCTYPE html>
<html lang="en-us">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>DEMO - Accelerate Hostpath with Fluid | Fluid</title>
    <meta name="generator" content="VuePress 1.8.2">
    <link rel="icon" href="/fluid-stacked-color.svg">
    <meta name="description" content="Fluid, elastic data abstraction and acceleration for BigData/AI applications in cloud.">
    
    <link rel="preload" href="/assets/css/0.styles.edbab21a.css" as="style"><link rel="preload" href="/assets/js/app.ff89ebb7.js" as="script"><link rel="preload" href="/assets/js/2.9883a141.js" as="script"><link rel="preload" href="/assets/js/40.04ca41b7.js" as="script"><link rel="prefetch" href="/assets/js/10.ff2f4ab4.js"><link rel="prefetch" href="/assets/js/11.7511cb62.js"><link rel="prefetch" href="/assets/js/12.6cc0075a.js"><link rel="prefetch" href="/assets/js/13.ac2fd551.js"><link rel="prefetch" href="/assets/js/14.6c27fec2.js"><link rel="prefetch" href="/assets/js/15.5b399203.js"><link rel="prefetch" href="/assets/js/16.56d4c631.js"><link rel="prefetch" href="/assets/js/17.ded4c0e4.js"><link rel="prefetch" href="/assets/js/18.63823924.js"><link rel="prefetch" href="/assets/js/19.403ee62d.js"><link rel="prefetch" href="/assets/js/20.0b8ab171.js"><link rel="prefetch" href="/assets/js/21.4b4f535c.js"><link rel="prefetch" href="/assets/js/22.aca0862a.js"><link rel="prefetch" href="/assets/js/23.1ef5c1d2.js"><link rel="prefetch" href="/assets/js/24.793d122b.js"><link rel="prefetch" href="/assets/js/25.5a478a64.js"><link rel="prefetch" href="/assets/js/26.128776a2.js"><link rel="prefetch" href="/assets/js/27.f4afbc76.js"><link rel="prefetch" href="/assets/js/28.cb0e85f7.js"><link rel="prefetch" href="/assets/js/29.2849f366.js"><link rel="prefetch" href="/assets/js/3.2ada5a00.js"><link rel="prefetch" href="/assets/js/30.4c8dfe96.js"><link rel="prefetch" href="/assets/js/31.70054216.js"><link rel="prefetch" href="/assets/js/32.392b4ec1.js"><link rel="prefetch" href="/assets/js/33.3b370eba.js"><link rel="prefetch" href="/assets/js/34.41a7b5eb.js"><link rel="prefetch" href="/assets/js/35.95f0a00d.js"><link rel="prefetch" href="/assets/js/36.168f5f83.js"><link rel="prefetch" href="/assets/js/37.4452566b.js"><link rel="prefetch" href="/assets/js/38.901c3a3c.js"><link rel="prefetch" href="/assets/js/39.ec1506de.js"><link rel="prefetch" href="/assets/js/4.c98b7bc1.js"><link rel="prefetch" href="/assets/js/41.3e25d182.js"><link rel="prefetch" href="/assets/js/42.1727ac1f.js"><link rel="prefetch" href="/assets/js/43.bce70a95.js"><link rel="prefetch" href="/assets/js/44.7ac691a6.js"><link rel="prefetch" href="/assets/js/45.be2e439b.js"><link rel="prefetch" href="/assets/js/46.05713c89.js"><link rel="prefetch" href="/assets/js/47.8ea80a90.js"><link rel="prefetch" href="/assets/js/48.1583acd2.js"><link rel="prefetch" href="/assets/js/49.aa1e9b68.js"><link rel="prefetch" href="/assets/js/5.f5746beb.js"><link rel="prefetch" href="/assets/js/50.21c7a3f8.js"><link rel="prefetch" href="/assets/js/51.4aa0466d.js"><link rel="prefetch" href="/assets/js/52.7a76af04.js"><link rel="prefetch" href="/assets/js/53.d536675e.js"><link rel="prefetch" href="/assets/js/54.de903366.js"><link rel="prefetch" href="/assets/js/55.9253880d.js"><link rel="prefetch" href="/assets/js/56.182caf99.js"><link rel="prefetch" href="/assets/js/57.e637b6a7.js"><link rel="prefetch" href="/assets/js/58.f13666f3.js"><link rel="prefetch" href="/assets/js/59.2f3414d9.js"><link rel="prefetch" href="/assets/js/6.8b6ef391.js"><link rel="prefetch" href="/assets/js/60.2e782ed8.js"><link rel="prefetch" href="/assets/js/61.912178b8.js"><link rel="prefetch" href="/assets/js/62.fe49a10b.js"><link rel="prefetch" href="/assets/js/63.e955b402.js"><link rel="prefetch" href="/assets/js/64.5a01d069.js"><link rel="prefetch" href="/assets/js/65.c387d4a2.js"><link rel="prefetch" href="/assets/js/66.d6fc89ad.js"><link rel="prefetch" href="/assets/js/67.ecece501.js"><link rel="prefetch" href="/assets/js/68.0de414a9.js"><link rel="prefetch" href="/assets/js/69.c3b6d603.js"><link rel="prefetch" href="/assets/js/7.480203b2.js"><link rel="prefetch" href="/assets/js/70.c3c1666d.js"><link rel="prefetch" href="/assets/js/71.74b515d0.js"><link rel="prefetch" href="/assets/js/72.565535fb.js"><link rel="prefetch" href="/assets/js/73.aa4b80fa.js"><link rel="prefetch" href="/assets/js/74.5babfb55.js"><link rel="prefetch" href="/assets/js/75.c240aa07.js"><link rel="prefetch" href="/assets/js/76.bdf11e70.js"><link rel="prefetch" href="/assets/js/77.da79c69e.js"><link rel="prefetch" href="/assets/js/78.b025a170.js"><link rel="prefetch" href="/assets/js/79.a0ef641e.js"><link rel="prefetch" href="/assets/js/8.ceafe7a8.js"><link rel="prefetch" href="/assets/js/80.9488d79d.js"><link rel="prefetch" href="/assets/js/81.bda0a9bb.js"><link rel="prefetch" href="/assets/js/82.8c563a57.js"><link rel="prefetch" href="/assets/js/83.9e589297.js"><link rel="prefetch" href="/assets/js/84.5c46079d.js"><link rel="prefetch" href="/assets/js/85.469b5e0f.js"><link rel="prefetch" href="/assets/js/86.1cfc9826.js"><link rel="prefetch" href="/assets/js/87.33adc5b0.js"><link rel="prefetch" href="/assets/js/88.adc406fa.js"><link rel="prefetch" href="/assets/js/89.8f120c05.js"><link rel="prefetch" href="/assets/js/9.c4bb6552.js"><link rel="prefetch" href="/assets/js/90.3728026e.js"><link rel="prefetch" href="/assets/js/91.a0fcfd1f.js">
    <link rel="stylesheet" href="/assets/css/0.styles.edbab21a.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><img src="/fluid-horizontal-color.png" alt="Fluid" class="logo"></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Docs" class="dropdown-title"><span class="title">Docs</span> <span class="arrow down"></span></button> <button type="button" aria-label="Docs" class="mobile-dropdown-title"><span class="title">Docs</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/guide/" class="nav-link">
  Guide
</a></li><li class="dropdown-item"><!----> <a href="/dev/" class="nav-link">
  Dev
</a></li><li class="dropdown-item"><!----> <a href="/samples/" class="nav-link router-link-active">
  Samples
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Community" class="dropdown-title"><span class="title">Community</span> <span class="arrow down"></span></button> <button type="button" aria-label="Community" class="mobile-dropdown-title"><span class="title">Community</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/community/community.html" class="nav-link">
  Community
</a></li><li class="dropdown-item"><!----> <a href="/community/ADOPTERS.html" class="nav-link">
  Adopters
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Blog" class="dropdown-title"><span class="title">Blog</span> <span class="arrow down"></span></button> <button type="button" aria-label="Blog" class="mobile-dropdown-title"><span class="title">Blog</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/blog/technology/" class="nav-link">
  Technology
</a></li><li class="dropdown-item"><!----> <a href="/blog/releases/" class="nav-link">
  Releases
</a></li><li class="dropdown-item"><!----> <a href="/blog/casestudy/" class="nav-link">
  Case Study
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Select language" class="dropdown-title"><span class="title">Languages</span> <span class="arrow down"></span></button> <button type="button" aria-label="Select language" class="mobile-dropdown-title"><span class="title">Languages</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/samples/hostpath.html" aria-current="page" class="nav-link router-link-exact-active router-link-active">
  English
</a></li><li class="dropdown-item"><!----> <a href="/zh/samples/hostpath.html" class="nav-link">
  简体中文
</a></li></ul></div></div> <a href="https://github.com/fluid-cloudnative/fluid" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Docs" class="dropdown-title"><span class="title">Docs</span> <span class="arrow down"></span></button> <button type="button" aria-label="Docs" class="mobile-dropdown-title"><span class="title">Docs</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/guide/" class="nav-link">
  Guide
</a></li><li class="dropdown-item"><!----> <a href="/dev/" class="nav-link">
  Dev
</a></li><li class="dropdown-item"><!----> <a href="/samples/" class="nav-link router-link-active">
  Samples
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Community" class="dropdown-title"><span class="title">Community</span> <span class="arrow down"></span></button> <button type="button" aria-label="Community" class="mobile-dropdown-title"><span class="title">Community</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/community/community.html" class="nav-link">
  Community
</a></li><li class="dropdown-item"><!----> <a href="/community/ADOPTERS.html" class="nav-link">
  Adopters
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Blog" class="dropdown-title"><span class="title">Blog</span> <span class="arrow down"></span></button> <button type="button" aria-label="Blog" class="mobile-dropdown-title"><span class="title">Blog</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/blog/technology/" class="nav-link">
  Technology
</a></li><li class="dropdown-item"><!----> <a href="/blog/releases/" class="nav-link">
  Releases
</a></li><li class="dropdown-item"><!----> <a href="/blog/casestudy/" class="nav-link">
  Case Study
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Select language" class="dropdown-title"><span class="title">Languages</span> <span class="arrow down"></span></button> <button type="button" aria-label="Select language" class="mobile-dropdown-title"><span class="title">Languages</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/samples/hostpath.html" aria-current="page" class="nav-link router-link-exact-active router-link-active">
  English
</a></li><li class="dropdown-item"><!----> <a href="/zh/samples/hostpath.html" class="nav-link">
  简体中文
</a></li></ul></div></div> <a href="https://github.com/fluid-cloudnative/fluid" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav>  <ul class="sidebar-links"><li><a href="/samples/" aria-current="page" class="sidebar-link">DEMO - Speed Up Accessing Remote Files</a></li><li><a href="/samples/accelerate_pvc.html" class="sidebar-link">DEMO - Accelerate PVC with Fluid</a></li><li><a href="/samples/machinelearning.html" class="sidebar-link">DEMO - Accelerate Machine Learning Training with Fluid</a></li><li><a href="/samples/data_warmup.html" class="sidebar-link">Demo - Data Preloading</a></li><li><a href="/samples/accelerate_hdfs.html" class="sidebar-link">DEMO - Speed Up Accessing HDFS Client Files</a></li><li><a href="/samples/accelerate_s3_minio.html" class="sidebar-link">DEMO - Speed Up Accessing Minio Files</a></li><li><a href="/samples/data_co_locality.html" class="sidebar-link">DEMO - Cache Co-locality for Workload Scheduling</a></li><li><a href="/samples/multi_dataset_same_node_accessing.html" class="sidebar-link">DEMO - Single-Machine Multiple-Dataset Speed Up Accessing Remote Files</a></li><li><a href="/samples/nonroot_access.html" class="sidebar-link">Example - Using Fluid to access non-root user's data</a></li><li><a href="/samples/tieredstore_config.html" class="sidebar-link">Demo - Alluxio Tieredstore Configuration</a></li><li><a href="/samples/use_encryptoptions.html" class="sidebar-link">DEMO - Use Secret to configure Dataset sensitive information</a></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="demo-accelerate-hostpath-with-fluid"><a href="#demo-accelerate-hostpath-with-fluid" class="header-anchor">#</a> DEMO - Accelerate Hostpath with Fluid</h1> <h2 id="test-scenario-resnet50-model-training"><a href="#test-scenario-resnet50-model-training" class="header-anchor">#</a> Test scenario: ResNet50 model training</h2> <ul><li>Machine： V100 x8</li> <li>NFS Server：38037492dc-pol25.cn-shanghai.nas.aliyuncs.com</li></ul> <h2 id="settings"><a href="#settings" class="header-anchor">#</a> Settings</h2> <h3 id="hardware"><a href="#hardware" class="header-anchor">#</a> Hardware</h3> <table><thead><tr><th>Cluster</th> <th>Alibaba Cloud Kubernetes. v1.16.9-aliyun.1</th></tr></thead> <tbody><tr><td>ECS Instance</td> <td>ECS   specifications：ecs.gn6v-c10g1.20xlarge<br>    CPU：82 cores</td></tr> <tr><td>Distributed Storage</td> <td>NAS</td></tr></tbody></table> <h3 id="software"><a href="#software" class="header-anchor">#</a> Software</h3> <p>Software version: 0.18.1-tf1.14.0-torch1.2.0-mxnet1.5.0-py3.6</p> <h2 id="prerequisites"><a href="#prerequisites" class="header-anchor">#</a> Prerequisites</h2> <ul><li><a href="https://github.com/fluid-cloudnative/fluid" target="_blank" rel="noopener noreferrer">Fluid<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> (version &gt;= 0.3.0)</li> <li><a href="https://github.com/kubeflow/arena" target="_blank" rel="noopener noreferrer">Arena<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>（version &gt;= 0.4.0）</li> <li><a href="https://github.com/horovod/horovod" target="_blank" rel="noopener noreferrer">Horovod<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> (version=0.18.1)</li> <li><a href="https://github.com/tensorflow/benchmarks/tree/cnn_tf_v1.14_compatible" target="_blank" rel="noopener noreferrer">Benchmark<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul> <h2 id="known-constraints"><a href="#known-constraints" class="header-anchor">#</a> Known constraints</h2> <ul><li>It is not recommended to use the host directory to achieve mount, because this method relies on kubernetes' unexpected mount point maintenance method, which is actually not reliable and may cause data inconsistency.</li></ul> <h2 id="prepare-dataset"><a href="#prepare-dataset" class="header-anchor">#</a> Prepare Dataset</h2> <ol><li>Download</li></ol> <div class="language-bash extra-class"><pre class="language-bash"><code>$ <span class="token function">wget</span> http://imagenet-tar.oss-cn-shanghai.aliyuncs.com/imagenet.tar.gz
</code></pre></div><ol start="2"><li>Unpack</li></ol> <div class="language-bash extra-class"><pre class="language-bash"><code>$ <span class="token function">tar</span> -I pigz -xvf imagenet.tar.gz
</code></pre></div><h2 id="nfs-dawnbench"><a href="#nfs-dawnbench" class="header-anchor">#</a> NFS dawnbench</h2> <h3 id="deploy-dataset"><a href="#deploy-dataset" class="header-anchor">#</a> Deploy Dataset</h3> <ol><li><p>Export Dataset on Your NFS Server</p></li> <li><p>Mount NFS to Host Directory</p></li></ol> <div class="language-bash extra-class"><pre class="language-bash"><code>$ <span class="token function">sudo</span> <span class="token function">mount</span> -t nfs -o <span class="token assign-left variable">vers</span><span class="token operator">=</span><span class="token number">3</span>,nolock,proto<span class="token operator">=</span>tcp,rsize<span class="token operator">=</span><span class="token number">1048576</span>,wsize<span class="token operator">=</span><span class="token number">1048576</span>,hard,timeo<span class="token operator">=</span><span class="token number">600</span>,retrans<span class="token operator">=</span><span class="token number">2</span>,noresvport <span class="token operator">&lt;</span>YOUR_NFS_SERVER<span class="token operator">&gt;</span>:<span class="token operator">&lt;</span>YOUR_PATH_TO_DATASET<span class="token operator">&gt;</span> /mnt/nfs-imagenet
</code></pre></div><ol start="3"><li>Check Volume</li></ol> <div class="language-bash extra-class"><pre class="language-bash"><code>$ <span class="token function">mount</span> <span class="token operator">|</span> <span class="token function">grep</span> nfs
<span class="token operator">&lt;</span>YOUR_NFS_SERVER<span class="token operator">&gt;</span>:<span class="token operator">&lt;</span>YOUR_PATH_TO_DATASET<span class="token operator">&gt;</span> on /mnt/nfs-imagenet <span class="token builtin class-name">type</span> nfs <span class="token punctuation">(</span>rw,relatime,vers<span class="token operator">=</span><span class="token number">3</span>,rsize<span class="token operator">=</span><span class="token number">1048576</span>,wsize<span class="token operator">=</span><span class="token number">1048576</span>,namlen<span class="token operator">=</span><span class="token number">255</span>,hard,nolock,noresvport,proto<span class="token operator">=</span>tcp,timeo<span class="token operator">=</span><span class="token number">600</span>,retrans<span class="token operator">=</span><span class="token number">2</span>,sec<span class="token operator">=</span>sys,mountaddr<span class="token operator">=</span><span class="token number">192.168</span>.1.28,mountvers<span class="token operator">=</span><span class="token number">3</span>,mountport<span class="token operator">=</span><span class="token number">2049</span>,mountproto<span class="token operator">=</span>tcp,local_lock<span class="token operator">=</span>all,addr<span class="token operator">=</span><span class="token number">192.168</span>.1.28<span class="token punctuation">)</span>
</code></pre></div><blockquote><p><strong>NOTE:</strong></p> <p>修改上述命令中的<code>&lt;YOUR_NFS_SERVER&gt;</code>和<code>&lt;YOUR_PATH_TO_DATASET&gt;</code>为您的nfs server地址和挂载路径。</p></blockquote> <h3 id="dawnbench"><a href="#dawnbench" class="header-anchor">#</a> Dawnbench</h3> <h4 id="_1x8"><a href="#_1x8" class="header-anchor">#</a> 1x8</h4> <div class="language-bash extra-class"><pre class="language-bash"><code>arena submit mpijob <span class="token punctuation">\</span>
--name horovod-v2-nfs-hostpath-1x8-093000 <span class="token punctuation">\</span>
--gpus<span class="token operator">=</span><span class="token number">8</span> <span class="token punctuation">\</span>
--workers<span class="token operator">=</span><span class="token number">1</span> <span class="token punctuation">\</span>
--working-dir<span class="token operator">=</span>/horovod-demo/tensorflow-demo/ <span class="token punctuation">\</span>
--data-dir /mnt/nfs-imagenet:/data <span class="token punctuation">\</span>
-e <span class="token assign-left variable">DATA_DIR</span><span class="token operator">=</span>/data/imagenet <span class="token punctuation">\</span>
-e <span class="token assign-left variable">num_batch</span><span class="token operator">=</span><span class="token number">1000</span> <span class="token punctuation">\</span>
-e <span class="token assign-left variable">datasets_num_private_threads</span><span class="token operator">=</span><span class="token number">8</span> <span class="token punctuation">\</span>
--image<span class="token operator">=</span>registry.cn-hangzhou.aliyuncs.com/tensorflow-samples/horovod-benchmark-dawnbench-v2:0.18.1-tf1.14.0-torch1.2.0-mxnet1.5.0-py3.6 <span class="token punctuation">\</span>
./launch-example.sh <span class="token number">1</span> <span class="token number">8</span>
</code></pre></div><h4 id="_4x8"><a href="#_4x8" class="header-anchor">#</a> 4x8</h4> <div class="language-bash extra-class"><pre class="language-bash"><code>arena submit mpi <span class="token punctuation">\</span>
--name horovod-v2-nfs-hostpath-4x8-092921 <span class="token punctuation">\</span>
--gpus<span class="token operator">=</span><span class="token number">8</span> <span class="token punctuation">\</span>
--workers<span class="token operator">=</span><span class="token number">4</span> <span class="token punctuation">\</span> 
--working-dir<span class="token operator">=</span>/horovod-demo/tensorflow-demo/ <span class="token punctuation">\</span> 
--data-dir /mnt/nfs-imagenet:/data <span class="token punctuation">\</span>
-e <span class="token assign-left variable">DATA_DIR</span><span class="token operator">=</span>/data/imagenet <span class="token punctuation">\</span>
-e <span class="token assign-left variable">num_batch</span><span class="token operator">=</span><span class="token number">1000</span> <span class="token punctuation">\</span>
-e <span class="token assign-left variable">datasets_num_private_threads</span><span class="token operator">=</span><span class="token number">8</span> <span class="token punctuation">\</span>
--image<span class="token operator">=</span>registry.cn-hangzhou.aliyuncs.com/tensorflow-samples/horovod-benchmark-dawnbench-v2:0.18.1-tf1.14.0-torch1.2.0-mxnet1.5.0-py3.6 <span class="token punctuation">\</span>
./launch-example.sh <span class="token number">4</span> <span class="token number">8</span>
</code></pre></div><h2 id="accelerate-hostpath-with-fluid"><a href="#accelerate-hostpath-with-fluid" class="header-anchor">#</a> Accelerate Hostpath with Fluid</h2> <h3 id="deploy-dataset-2"><a href="#deploy-dataset-2" class="header-anchor">#</a> Deploy Dataset</h3> <ol><li>Follow Previous Steps to Create NFS Volume</li> <li>Deploy Fluid to Accelerate Hostpath</li></ol> <div class="language-yaml extra-class"><pre class="language-yaml"><code>$ cat &lt;&lt;EOF <span class="token punctuation">&gt;</span> dataset.yaml
<span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> data.fluid.io/v1alpha1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> Dataset
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">name</span><span class="token punctuation">:</span> imagenet
<span class="token key atrule">spec</span><span class="token punctuation">:</span>
  <span class="token key atrule">mounts</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> <span class="token key atrule">mountPoint</span><span class="token punctuation">:</span> local<span class="token punctuation">:</span>///mnt/nfs<span class="token punctuation">-</span>imagenet
    <span class="token key atrule">name</span><span class="token punctuation">:</span> imagenet
  <span class="token key atrule">nodeAffinity</span><span class="token punctuation">:</span>
    <span class="token key atrule">required</span><span class="token punctuation">:</span>
      <span class="token key atrule">nodeSelectorTerms</span><span class="token punctuation">:</span>
        <span class="token punctuation">-</span> <span class="token key atrule">matchExpressions</span><span class="token punctuation">:</span>
            <span class="token punctuation">-</span> <span class="token key atrule">key</span><span class="token punctuation">:</span> aliyun.accelerator/nvidia_name
              <span class="token key atrule">operator</span><span class="token punctuation">:</span> In
              <span class="token key atrule">values</span><span class="token punctuation">:</span>
                <span class="token punctuation">-</span> Tesla<span class="token punctuation">-</span>V100<span class="token punctuation">-</span>SXM2<span class="token punctuation">-</span>16GB
<span class="token punctuation">---</span>
<span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> data.fluid.io/v1alpha1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> AlluxioRuntime
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">name</span><span class="token punctuation">:</span> imagenet
<span class="token key atrule">spec</span><span class="token punctuation">:</span>
  <span class="token key atrule">replicas</span><span class="token punctuation">:</span> <span class="token number">4</span>
  <span class="token key atrule">data</span><span class="token punctuation">:</span>
    <span class="token key atrule">replicas</span><span class="token punctuation">:</span> <span class="token number">1</span>
  <span class="token key atrule">tieredstore</span><span class="token punctuation">:</span>
    <span class="token key atrule">levels</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> <span class="token key atrule">mediumtype</span><span class="token punctuation">:</span> MEM
        <span class="token key atrule">path</span><span class="token punctuation">:</span> /alluxio/ram 
        <span class="token key atrule">quota</span><span class="token punctuation">:</span> 50Gi
        <span class="token key atrule">high</span><span class="token punctuation">:</span> <span class="token string">&quot;0.99&quot;</span>
        <span class="token key atrule">low</span><span class="token punctuation">:</span> <span class="token string">&quot;0.8&quot;</span>
EOF
</code></pre></div><blockquote><p><strong>NOTE:</strong></p> <ul><li><code>mounts.mountPoint</code>通过<code>local://</code>的前缀来指明要挂载的主机目录(e.g. <code>/mnt/nfs-imagenet</code>)</li> <li><code>spec.replicas</code>和dawnbench测试的worker数量保持一致。比如：单机八卡为1，四机八卡为4</li> <li><code>nodeSelectorTerms</code>作用是限制在有V100显卡的机器上部署数据集，此处应根据实验环境具体调节</li></ul></blockquote> <div class="language-bash extra-class"><pre class="language-bash"><code>$ kubectl create -f dataset.yaml
</code></pre></div><ol start="3"><li>Check Volume</li></ol> <div class="language-bash extra-class"><pre class="language-bash"><code>$ kubectl get pv,pvc
NAME                        CAPACITY   ACCESS MODES   RECLAIM POLICY   STATUS   CLAIM              STORAGECLASS   REASON   AGE
persistentvolume/imagenet   100Gi      RWX            Retain           Bound    default/imagenet                           3h28m

NAME                             STATUS   VOLUME     CAPACITY   ACCESS MODES   STORAGECLASS   AGE
persistentvolumeclaim/imagenet   Bound    imagenet   100Gi      RWX                           3h28m
</code></pre></div><h3 id="dawnbench-2"><a href="#dawnbench-2" class="header-anchor">#</a> dawnbench</h3> <h4 id="_1x8-2"><a href="#_1x8-2" class="header-anchor">#</a> 1x8</h4> <div class="language- extra-class"><pre class="language-text"><code>arena submit mpi \
--name horovod-v2-nfs-fluid-1x8-093009 \
--gpus=8 \
--workers=1 \
--working-dir=/horovod-demo/tensorflow-demo/ \
--data imagenet:/data \
-e DATA_DIR=/data/imagenet/imagenet \
-e num_batch=1000 \
-e datasets_num_private_threads=8 \
--image=registry.cn-hangzhou.aliyuncs.com/tensorflow-samples/horovod-benchmark-dawnbench-v2:0.18.1-tf1.14.0-torch1.2.0-mxnet1.5.0-py3.6 \
./launch-example.sh 1 8
</code></pre></div><h4 id="_4x8-2"><a href="#_4x8-2" class="header-anchor">#</a> 4x8</h4> <div class="language- extra-class"><pre class="language-text"><code>arena submit mpi \
--name horovod-v2-nfs-fluid-4x8-092910 \
--gpus=8 \
--workers=4 \
--working-dir=/horovod-demo/tensorflow-demo/ \
--data imagenet:/data \
-e DATA_DIR=/data/imagenet/imagenet \
-e num_batch=1000 \
-e datasets_num_private_threads=8 \
--image=registry.cn-hangzhou.aliyuncs.com/tensorflow-samples/horovod-benchmark-dawnbench-v2:0.18.1-tf1.14.0-torch1.2.0-mxnet1.5.0-py3.6 \
./launch-example.sh 4 8
</code></pre></div><h2 id="experiment-results"><a href="#experiment-results" class="header-anchor">#</a> Experiment Results</h2> <h3 id="horovod-1x8"><a href="#horovod-1x8" class="header-anchor">#</a> horovod-1x8</h3> <table><thead><tr><th></th> <th>nfs-hostpath</th> <th>fluid (cold)</th> <th>fluid (warm)</th></tr></thead> <tbody><tr><td>raining time</td> <td>4h20m36s</td> <td>4h21m56s</td> <td>4h2m16s</td></tr> <tr><td>Speed at the 1000 step(images/second)</td> <td>2426.4</td> <td>2467.2</td> <td>8959.7</td></tr> <tr><td>Speed at the last step(images/second)</td> <td>8218.1</td> <td>8219.8</td> <td>8275.8</td></tr> <tr><td>steps</td> <td>56300</td> <td>56300</td> <td>56300</td></tr> <tr><td>Accuracy @ 5</td> <td>0.9280</td> <td>0.9288</td> <td>0.9291</td></tr></tbody></table> <h3 id="horovod-4x8"><a href="#horovod-4x8" class="header-anchor">#</a> horovod-4x8</h3> <table><thead><tr><th></th> <th>nfs-hostpath</th> <th>fluid (cold)</th> <th>fluid (warm)</th></tr></thead> <tbody><tr><td>训练时间</td> <td>2h9m21s</td> <td>1h40m15s</td> <td>1h29m55s</td></tr> <tr><td>Speed at the 1000 step(images/second)</td> <td>3219.2</td> <td>11067.2</td> <td>21951.3</td></tr> <tr><td>Speed at the last step(images/second)</td> <td>15855.7</td> <td>20964.4</td> <td>21869.8</td></tr> <tr><td>steps</td> <td>14070</td> <td>14070</td> <td>14070</td></tr> <tr><td>Accuracy @ 5</td> <td>0.9227</td> <td>0.9232</td> <td>0.9228</td></tr></tbody></table> <h2 id="结果分析"><a href="#结果分析" class="header-anchor">#</a> 结果分析</h2> <p>From the test results, the Fluid acceleration effect on 1x8 has no obvious effect,
but in the scenario of 4x8, the effect is very obvious.
In warm data scenario, the training time can be shortened (135-92)/135 = 31%;
In cold data scenario, training time can be shortened (135-103) /135 = 23%.
This is because NFS bandwidth became a bottleneck under 4x8;
Fluid based on Alluxio provides distributed cache data reading capability for P2P data.</p></div> <footer class="page-edit"><!----> <!----></footer> <!----> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.ff89ebb7.js" defer></script><script src="/assets/js/2.9883a141.js" defer></script><script src="/assets/js/40.04ca41b7.js" defer></script>
  </body>
</html>
