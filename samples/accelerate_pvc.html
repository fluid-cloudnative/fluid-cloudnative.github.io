<!DOCTYPE html>
<html lang="en-us">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>DEMO - Accelerate PVC with Fluid | Fluid</title>
    <meta name="generator" content="VuePress 1.8.2">
    <link rel="icon" href="/fluid/fluid-stacked-color.svg">
    <meta name="description" content="Fluid, elastic data abstraction and acceleration for BigData/AI applications in cloud.">
    
    <link rel="preload" href="/fluid/assets/css/0.styles.29bd8075.css" as="style"><link rel="preload" href="/fluid/assets/js/app.f9e62644.js" as="script"><link rel="preload" href="/fluid/assets/js/2.81b06f56.js" as="script"><link rel="preload" href="/fluid/assets/js/36.27b2095a.js" as="script"><link rel="prefetch" href="/fluid/assets/js/10.a7a7f143.js"><link rel="prefetch" href="/fluid/assets/js/11.1b4f7b93.js"><link rel="prefetch" href="/fluid/assets/js/12.e25637fe.js"><link rel="prefetch" href="/fluid/assets/js/13.7d33f66c.js"><link rel="prefetch" href="/fluid/assets/js/14.ac00622c.js"><link rel="prefetch" href="/fluid/assets/js/15.60a1a2c4.js"><link rel="prefetch" href="/fluid/assets/js/16.6bf3f575.js"><link rel="prefetch" href="/fluid/assets/js/17.cc350b58.js"><link rel="prefetch" href="/fluid/assets/js/18.756a9497.js"><link rel="prefetch" href="/fluid/assets/js/19.fbab515e.js"><link rel="prefetch" href="/fluid/assets/js/20.f2981a5f.js"><link rel="prefetch" href="/fluid/assets/js/21.6a1ec5db.js"><link rel="prefetch" href="/fluid/assets/js/22.c1cfacd9.js"><link rel="prefetch" href="/fluid/assets/js/23.982e23bf.js"><link rel="prefetch" href="/fluid/assets/js/24.1400768d.js"><link rel="prefetch" href="/fluid/assets/js/25.298f3427.js"><link rel="prefetch" href="/fluid/assets/js/26.ac324b7f.js"><link rel="prefetch" href="/fluid/assets/js/27.e2ec094d.js"><link rel="prefetch" href="/fluid/assets/js/28.54ce4fbc.js"><link rel="prefetch" href="/fluid/assets/js/29.77159cd6.js"><link rel="prefetch" href="/fluid/assets/js/3.15d2605a.js"><link rel="prefetch" href="/fluid/assets/js/30.f4d8768b.js"><link rel="prefetch" href="/fluid/assets/js/31.99125a09.js"><link rel="prefetch" href="/fluid/assets/js/32.adb060ef.js"><link rel="prefetch" href="/fluid/assets/js/33.87f2909b.js"><link rel="prefetch" href="/fluid/assets/js/34.71d13ee4.js"><link rel="prefetch" href="/fluid/assets/js/35.c35a0c5d.js"><link rel="prefetch" href="/fluid/assets/js/37.db8d7254.js"><link rel="prefetch" href="/fluid/assets/js/38.dfcaa5cd.js"><link rel="prefetch" href="/fluid/assets/js/39.56d5b7da.js"><link rel="prefetch" href="/fluid/assets/js/4.4a1f5422.js"><link rel="prefetch" href="/fluid/assets/js/40.453612bd.js"><link rel="prefetch" href="/fluid/assets/js/41.9ad80150.js"><link rel="prefetch" href="/fluid/assets/js/42.5a0be010.js"><link rel="prefetch" href="/fluid/assets/js/43.5fdcdb98.js"><link rel="prefetch" href="/fluid/assets/js/44.87824c99.js"><link rel="prefetch" href="/fluid/assets/js/45.113b6e73.js"><link rel="prefetch" href="/fluid/assets/js/46.d509fb90.js"><link rel="prefetch" href="/fluid/assets/js/47.776180dd.js"><link rel="prefetch" href="/fluid/assets/js/48.42a629ea.js"><link rel="prefetch" href="/fluid/assets/js/49.02831f2f.js"><link rel="prefetch" href="/fluid/assets/js/5.0e9b77f5.js"><link rel="prefetch" href="/fluid/assets/js/50.1daab809.js"><link rel="prefetch" href="/fluid/assets/js/51.82ba3c7d.js"><link rel="prefetch" href="/fluid/assets/js/52.74009009.js"><link rel="prefetch" href="/fluid/assets/js/53.bf39b46b.js"><link rel="prefetch" href="/fluid/assets/js/54.607e1355.js"><link rel="prefetch" href="/fluid/assets/js/55.ca81c027.js"><link rel="prefetch" href="/fluid/assets/js/56.b8b236ed.js"><link rel="prefetch" href="/fluid/assets/js/57.12bffe29.js"><link rel="prefetch" href="/fluid/assets/js/58.3755fc28.js"><link rel="prefetch" href="/fluid/assets/js/59.f55f2829.js"><link rel="prefetch" href="/fluid/assets/js/6.c1eeb950.js"><link rel="prefetch" href="/fluid/assets/js/60.ac8faf06.js"><link rel="prefetch" href="/fluid/assets/js/61.a3bfb13b.js"><link rel="prefetch" href="/fluid/assets/js/62.2ad4b141.js"><link rel="prefetch" href="/fluid/assets/js/63.ea2e8951.js"><link rel="prefetch" href="/fluid/assets/js/64.1de362fc.js"><link rel="prefetch" href="/fluid/assets/js/65.1c38b20d.js"><link rel="prefetch" href="/fluid/assets/js/66.7a4a0a43.js"><link rel="prefetch" href="/fluid/assets/js/67.4b41a609.js"><link rel="prefetch" href="/fluid/assets/js/68.e2942832.js"><link rel="prefetch" href="/fluid/assets/js/69.169f9b66.js"><link rel="prefetch" href="/fluid/assets/js/7.17ef356c.js"><link rel="prefetch" href="/fluid/assets/js/70.6e11ada7.js"><link rel="prefetch" href="/fluid/assets/js/71.31c8561e.js"><link rel="prefetch" href="/fluid/assets/js/72.ea615c40.js"><link rel="prefetch" href="/fluid/assets/js/73.a0a53af9.js"><link rel="prefetch" href="/fluid/assets/js/74.5d0c24f0.js"><link rel="prefetch" href="/fluid/assets/js/75.8c3ee9b9.js"><link rel="prefetch" href="/fluid/assets/js/76.db59eda3.js"><link rel="prefetch" href="/fluid/assets/js/77.bf4218e9.js"><link rel="prefetch" href="/fluid/assets/js/78.0ed57319.js"><link rel="prefetch" href="/fluid/assets/js/79.09617cdb.js"><link rel="prefetch" href="/fluid/assets/js/8.8d58fc92.js"><link rel="prefetch" href="/fluid/assets/js/80.1582f6ed.js"><link rel="prefetch" href="/fluid/assets/js/81.e5cef51e.js"><link rel="prefetch" href="/fluid/assets/js/82.c288f404.js"><link rel="prefetch" href="/fluid/assets/js/83.416b4c7b.js"><link rel="prefetch" href="/fluid/assets/js/84.1f48cbfe.js"><link rel="prefetch" href="/fluid/assets/js/85.de55feec.js"><link rel="prefetch" href="/fluid/assets/js/86.c0ae41f2.js"><link rel="prefetch" href="/fluid/assets/js/87.efaecb95.js"><link rel="prefetch" href="/fluid/assets/js/88.88f66ba6.js"><link rel="prefetch" href="/fluid/assets/js/89.a1cf0750.js"><link rel="prefetch" href="/fluid/assets/js/9.10583e0b.js"><link rel="prefetch" href="/fluid/assets/js/90.18ce4d94.js"><link rel="prefetch" href="/fluid/assets/js/91.edfffb17.js">
    <link rel="stylesheet" href="/fluid/assets/css/0.styles.29bd8075.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/fluid/" class="home-link router-link-active"><img src="/fluid/fluid-horizontal-color.png" alt="Fluid" class="logo"></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Docs" class="dropdown-title"><span class="title">Docs</span> <span class="arrow down"></span></button> <button type="button" aria-label="Docs" class="mobile-dropdown-title"><span class="title">Docs</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/fluid/guide/" class="nav-link">
  Guide
</a></li><li class="dropdown-item"><!----> <a href="/fluid/dev/" class="nav-link">
  Dev
</a></li><li class="dropdown-item"><!----> <a href="/fluid/samples/" class="nav-link router-link-active">
  Samples
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Community" class="dropdown-title"><span class="title">Community</span> <span class="arrow down"></span></button> <button type="button" aria-label="Community" class="mobile-dropdown-title"><span class="title">Community</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/fluid/community/community.html" class="nav-link">
  Community
</a></li><li class="dropdown-item"><!----> <a href="/fluid/community/ADOPTERS.html" class="nav-link">
  Adopters
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Blog" class="dropdown-title"><span class="title">Blog</span> <span class="arrow down"></span></button> <button type="button" aria-label="Blog" class="mobile-dropdown-title"><span class="title">Blog</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/fluid/blog/technology/" class="nav-link">
  Technology
</a></li><li class="dropdown-item"><!----> <a href="/fluid/blog/releases/" class="nav-link">
  Releases
</a></li><li class="dropdown-item"><!----> <a href="/fluid/blog/casestudy/" class="nav-link">
  Case Study
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Select language" class="dropdown-title"><span class="title">Languages</span> <span class="arrow down"></span></button> <button type="button" aria-label="Select language" class="mobile-dropdown-title"><span class="title">Languages</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/fluid/samples/accelerate_pvc.html" aria-current="page" class="nav-link router-link-exact-active router-link-active">
  English
</a></li><li class="dropdown-item"><!----> <a href="/fluid/zh/samples/accelerate_pvc.html" class="nav-link">
  简体中文
</a></li></ul></div></div> <a href="https://github.com/fluid-cloudnative/fluid" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Docs" class="dropdown-title"><span class="title">Docs</span> <span class="arrow down"></span></button> <button type="button" aria-label="Docs" class="mobile-dropdown-title"><span class="title">Docs</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/fluid/guide/" class="nav-link">
  Guide
</a></li><li class="dropdown-item"><!----> <a href="/fluid/dev/" class="nav-link">
  Dev
</a></li><li class="dropdown-item"><!----> <a href="/fluid/samples/" class="nav-link router-link-active">
  Samples
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Community" class="dropdown-title"><span class="title">Community</span> <span class="arrow down"></span></button> <button type="button" aria-label="Community" class="mobile-dropdown-title"><span class="title">Community</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/fluid/community/community.html" class="nav-link">
  Community
</a></li><li class="dropdown-item"><!----> <a href="/fluid/community/ADOPTERS.html" class="nav-link">
  Adopters
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Blog" class="dropdown-title"><span class="title">Blog</span> <span class="arrow down"></span></button> <button type="button" aria-label="Blog" class="mobile-dropdown-title"><span class="title">Blog</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/fluid/blog/technology/" class="nav-link">
  Technology
</a></li><li class="dropdown-item"><!----> <a href="/fluid/blog/releases/" class="nav-link">
  Releases
</a></li><li class="dropdown-item"><!----> <a href="/fluid/blog/casestudy/" class="nav-link">
  Case Study
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Select language" class="dropdown-title"><span class="title">Languages</span> <span class="arrow down"></span></button> <button type="button" aria-label="Select language" class="mobile-dropdown-title"><span class="title">Languages</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/fluid/samples/accelerate_pvc.html" aria-current="page" class="nav-link router-link-exact-active router-link-active">
  English
</a></li><li class="dropdown-item"><!----> <a href="/fluid/zh/samples/accelerate_pvc.html" class="nav-link">
  简体中文
</a></li></ul></div></div> <a href="https://github.com/fluid-cloudnative/fluid" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav>  <ul class="sidebar-links"><li><a href="/fluid/samples/" aria-current="page" class="sidebar-link">DEMO - Speed Up Accessing Remote Files</a></li><li><a href="/fluid/samples/accelerate_pvc.html" aria-current="page" class="active sidebar-link">DEMO - Accelerate PVC with Fluid</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/fluid/samples/accelerate_pvc.html#test-scenario-resnet50-model-training" class="sidebar-link">Test scenario: ResNet50 model training</a></li><li class="sidebar-sub-header"><a href="/fluid/samples/accelerate_pvc.html#settings" class="sidebar-link">Settings</a></li><li class="sidebar-sub-header"><a href="/fluid/samples/accelerate_pvc.html#prerequisites" class="sidebar-link">Prerequisites</a></li><li class="sidebar-sub-header"><a href="/fluid/samples/accelerate_pvc.html#prepare-dataset" class="sidebar-link">Prepare Dataset</a></li><li class="sidebar-sub-header"><a href="/fluid/samples/accelerate_pvc.html#nfs-dawnbench" class="sidebar-link">NFS dawnbench</a></li><li class="sidebar-sub-header"><a href="/fluid/samples/accelerate_pvc.html#accelerate-pvc-with-fluid" class="sidebar-link">Accelerate PVC with Fluid</a></li><li class="sidebar-sub-header"><a href="/fluid/samples/accelerate_pvc.html#experiment-results" class="sidebar-link">Experiment Results</a></li><li class="sidebar-sub-header"><a href="/fluid/samples/accelerate_pvc.html#result-analysis" class="sidebar-link">Result analysis</a></li></ul></li><li><a href="/fluid/samples/machinelearning.html" class="sidebar-link">DEMO - Accelerate Machine Learning Training with Fluid</a></li><li><a href="/fluid/samples/data_warmup.html" class="sidebar-link">Demo - Data Preloading</a></li><li><a href="/fluid/samples/accelerate_hdfs.html" class="sidebar-link">DEMO - Speed Up Accessing HDFS Client Files</a></li><li><a href="/fluid/samples/accelerate_s3_minio.html" class="sidebar-link">DEMO - Speed Up Accessing Minio Files</a></li><li><a href="/fluid/samples/data_co_locality.html" class="sidebar-link">DEMO - Cache Co-locality for Workload Scheduling</a></li><li><a href="/fluid/samples/multi_dataset_same_node_accessing.html" class="sidebar-link">DEMO - Single-Machine Multiple-Dataset Speed Up Accessing Remote Files</a></li><li><a href="/fluid/samples/nonroot_access.html" class="sidebar-link">Example - Using Fluid to access non-root user's data</a></li><li><a href="/fluid/samples/tieredstore_config.html" class="sidebar-link">Demo - Alluxio Tieredstore Configuration</a></li><li><a href="/fluid/samples/use_encryptoptions.html" class="sidebar-link">DEMO - Use Secret to configure Dataset sensitive information</a></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="demo-accelerate-pvc-with-fluid"><a href="#demo-accelerate-pvc-with-fluid" class="header-anchor">#</a> DEMO - Accelerate PVC with Fluid</h1> <p><a href="https://fluid-imgs.oss-cn-shanghai.aliyuncs.com/public/video/accelerate_pvc.mp4" target="_blank" rel="noopener noreferrer"><img src="https://fluid-imgs.oss-cn-shanghai.aliyuncs.com/public/imgs/accelerate_pvc.jfif" alt=""><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <h2 id="test-scenario-resnet50-model-training"><a href="#test-scenario-resnet50-model-training" class="header-anchor">#</a> Test scenario: ResNet50 model training</h2> <ul><li>Machine： V100 x8</li> <li>NFS Server：38037492dc-pol25.cn-shanghai.nas.aliyuncs.com</li></ul> <h2 id="settings"><a href="#settings" class="header-anchor">#</a> Settings</h2> <h3 id="hardware"><a href="#hardware" class="header-anchor">#</a> Hardware</h3> <table><thead><tr><th>Cluster</th> <th>Alibaba Cloud Kubernetes. v1.16.9-aliyun.1</th></tr></thead> <tbody><tr><td>ECS Instance</td> <td>ECS   specifications：ecs.gn6v-c10g1.20xlarge<br>    CPU：82 cores</td></tr> <tr><td>Distributed Storage</td> <td>NAS</td></tr></tbody></table> <h3 id="software"><a href="#software" class="header-anchor">#</a> Software</h3> <p>Software version: 0.18.1-tf1.14.0-torch1.2.0-mxnet1.5.0-py3.6</p> <h2 id="prerequisites"><a href="#prerequisites" class="header-anchor">#</a> Prerequisites</h2> <ul><li><a href="https://github.com/fluid-cloudnative/fluid" target="_blank" rel="noopener noreferrer">Fluid<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> (version &gt;= 0.3.0)</li> <li><a href="https://github.com/kubeflow/arena" target="_blank" rel="noopener noreferrer">Arena<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>（version &gt;= 0.4.0）</li> <li><a href="https://github.com/horovod/horovod" target="_blank" rel="noopener noreferrer">Horovod<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> (version=0.18.1)</li> <li><a href="https://github.com/tensorflow/benchmarks/tree/cnn_tf_v1.14_compatible" target="_blank" rel="noopener noreferrer">Benchmark<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul> <h2 id="prepare-dataset"><a href="#prepare-dataset" class="header-anchor">#</a> Prepare Dataset</h2> <ol><li>Download</li></ol> <div class="language-bash extra-class"><pre class="language-bash"><code>$ <span class="token function">wget</span> http://imagenet-tar.oss-cn-shanghai.aliyuncs.com/imagenet.tar.gz
</code></pre></div><ol start="2"><li>Unpack</li></ol> <div class="language-bash extra-class"><pre class="language-bash"><code>$ <span class="token function">tar</span> -I pigz -xvf imagenet.tar.gz
</code></pre></div><h2 id="nfs-dawnbench"><a href="#nfs-dawnbench" class="header-anchor">#</a> NFS dawnbench</h2> <h3 id="deploy-dataset"><a href="#deploy-dataset" class="header-anchor">#</a> Deploy Dataset</h3> <ol><li><p>Export Dataset on Your NFS Server</p></li> <li><p>Create Volume using Kubernetes</p></li></ol> <div class="language-bash extra-class"><pre class="language-bash"><code>$ <span class="token function">cat</span> <span class="token operator">&lt;&lt;</span><span class="token string">EOF<span class="token bash punctuation"> <span class="token operator">&gt;</span> nfs.yaml</span>
apiVersion: v1
kind: PersistentVolume
metadata:
  name: nfs-imagenet
spec:
  capacity:
    storage: 150Gi
  volumeMode: Filesystem
  accessModes:
  - ReadOnlyMany
  persistentVolumeReclaimPolicy: Retain
  storageClassName: nfs
  mountOptions:
  - vers=3
  - nolock
  - proto=tcp
  - rsize=1048576
  - wsize=1048576
  - hard
  - timeo=600
  - retrans=2
  - noresvport
  - nfsvers=4.1
  nfs:
    path: &lt;YOUR_PATH_TO_DATASET&gt;
    server: &lt;YOUR_NFS_SERVER&gt;
---
apiVersion: v1
kind: PersistentVolumeClaim
metadata:
  name: nfs-imagenet
spec:
  accessModes:
  - ReadOnlyMany
  resources:
    requests:
      storage: 150Gi
  storageClassName: nfs
EOF</span>
</code></pre></div><blockquote><p><strong>NOTE:</strong></p> <p>Please replace <code>YOUR_PATH_TO_DATASET</code> and <code>YOUR_NFS_SERVER</code>
with your own nfs server address and path to dataset.</p></blockquote> <div class="language-bash extra-class"><pre class="language-bash"><code>$ kubectl create -f nfs.yaml
</code></pre></div><ol start="3"><li>Check Volume</li></ol> <div class="language-bash extra-class"><pre class="language-bash"><code>$ kubectl get pv,pvc
NAME                            CAPACITY   ACCESS MODES   RECLAIM POLICY   STATUS   CLAIM                  STORAGECLASS   REASON   AGE
persistentvolume/nfs-imagenet   150Gi      ROX            Retain           Bound    default/nfs-imagenet   nfs                     45s

NAME                                 STATUS   VOLUME         CAPACITY   ACCESS MODES   STORAGECLASS   AGE
persistentvolumeclaim/nfs-imagenet   Bound    nfs-imagenet   150Gi      ROX            nfs            45s
</code></pre></div><h3 id="dawnbench"><a href="#dawnbench" class="header-anchor">#</a> Dawnbench</h3> <blockquote><p>NOTES:</p> <p><code>1x8</code> means <code>1</code> machine with <code>8</code> GPU cards.</p></blockquote> <h4 id="_1x8"><a href="#_1x8" class="header-anchor">#</a> 1x8</h4> <div class="language-bash extra-class"><pre class="language-bash"><code>arena submit mpi <span class="token punctuation">\</span>
    --name horovod-resnet50-v2-1x8-nfs <span class="token punctuation">\</span>
    --gpus<span class="token operator">=</span><span class="token number">8</span> <span class="token punctuation">\</span>
    --workers<span class="token operator">=</span><span class="token number">1</span> <span class="token punctuation">\</span>
    --working-dir<span class="token operator">=</span>/horovod-demo/tensorflow-demo/ <span class="token punctuation">\</span>
    --data nfs-imagenet:/data <span class="token punctuation">\</span>
    -e <span class="token assign-left variable">DATA_DIR</span><span class="token operator">=</span>/data/imagenet <span class="token punctuation">\</span>
    -e <span class="token assign-left variable">num_batch</span><span class="token operator">=</span><span class="token number">1000</span> <span class="token punctuation">\</span>
    -e <span class="token assign-left variable">datasets_num_private_threads</span><span class="token operator">=</span><span class="token number">8</span> <span class="token punctuation">\</span>
    --image<span class="token operator">=</span>registry.cn-hangzhou.aliyuncs.com/tensorflow-samples/horovod-benchmark-dawnbench-v2:0.18.1-tf1.14.0-torch1.2.0-mxnet1.5.0-py3.6 <span class="token punctuation">\</span>
    ./launch-example.sh <span class="token number">1</span> <span class="token number">8</span>
</code></pre></div><h4 id="_4x8"><a href="#_4x8" class="header-anchor">#</a> 4x8</h4> <div class="language-bash extra-class"><pre class="language-bash"><code>arena submit mpi <span class="token punctuation">\</span>
    --name horovod-resnet50-v2-4x8-nfs <span class="token punctuation">\</span>
    --gpus<span class="token operator">=</span><span class="token number">8</span> <span class="token punctuation">\</span>
    --workers<span class="token operator">=</span><span class="token number">4</span> <span class="token punctuation">\</span>
    --working-dir<span class="token operator">=</span>/horovod-demo/tensorflow-demo/ <span class="token punctuation">\</span>
    --data nfs-imagenet:/data <span class="token punctuation">\</span>
    -e <span class="token assign-left variable">DATA_DIR</span><span class="token operator">=</span>/data/imagenet <span class="token punctuation">\</span>
    -e <span class="token assign-left variable">num_batch</span><span class="token operator">=</span><span class="token number">1000</span> <span class="token punctuation">\</span>
    -e <span class="token assign-left variable">datasets_num_private_threads</span><span class="token operator">=</span><span class="token number">8</span> <span class="token punctuation">\</span>
    --image<span class="token operator">=</span>registry.cn-hangzhou.aliyuncs.com/tensorflow-samples/horovod-benchmark-dawnbench-v2:0.18.1-tf1.14.0-torch1.2.0-mxnet1.5.0-py3.6 <span class="token punctuation">\</span>
    ./launch-example.sh <span class="token number">4</span> <span class="token number">8</span>
</code></pre></div><blockquote><p><strong>NOTE:</strong></p> <p>If you find that nfs volume cannot be deleted,
this is because Arena will leave a launcher pod after training finished,
and Kubernetes still thinks that volume is in using.</p> <p>Just execute following command to force deleting volume:</p> <div class="language-bash extra-class"><pre class="language-bash"><code>$ kubectl patch pvc nfs-imagenet  -p <span class="token string">'{&quot;metadata&quot;:{&quot;finalizers&quot;: []}}'</span> --type<span class="token operator">=</span>merge
</code></pre></div></blockquote> <h2 id="accelerate-pvc-with-fluid"><a href="#accelerate-pvc-with-fluid" class="header-anchor">#</a> Accelerate PVC with Fluid</h2> <h3 id="deploy-dataset-2"><a href="#deploy-dataset-2" class="header-anchor">#</a> Deploy Dataset</h3> <ol><li>Follow Previous Steps to Create NFS Volume</li> <li>Deploy Fluid to Accelerate NFS Volume</li></ol> <div class="language-bash extra-class"><pre class="language-bash"><code>$ <span class="token function">cat</span> <span class="token operator">&lt;&lt;</span><span class="token string">EOF<span class="token bash punctuation"> <span class="token operator">&gt;</span> dataset.yaml</span>
apiVersion: data.fluid.io/v1alpha1
kind: Dataset
metadata:
  name: fluid-imagenet
spec:
  mounts:
  - mountPoint: pvc://nfs-imagenet
    name: nfs-imagenet
  nodeAffinity:
    required:
      nodeSelectorTerms:
        - matchExpressions:
            - key: aliyun.accelerator/nvidia_name
              operator: In
              values:
                - Tesla-V100-SXM2-16GB
---
apiVersion: data.fluid.io/v1alpha1
kind: AlluxioRuntime
metadata:
  name: fluid-imagenet
spec:
  replicas: 4
  data:
    replicas: 1
  tieredstore:
    levels:
      - mediumtype: SSD
        path: /var/lib/docker/alluxio
        quota: 150Gi
        high: &quot;0.99&quot;
        low: &quot;0.8&quot;
EOF</span>
</code></pre></div><blockquote><p><strong>NOTE:</strong></p> <ul><li>Please keep <code>spec.replicas</code> consistent with the number of machines you are going to use for machine learning。</li> <li><code>nodeSelectorTerms</code> is used to restrict scheduling on machines with V100 GPU only.</li></ul></blockquote> <div class="language-bash extra-class"><pre class="language-bash"><code>$ kubectl create -f dataset.yaml
</code></pre></div><ol start="3"><li>Check Volume</li></ol> <div class="language-bash extra-class"><pre class="language-bash"><code>$ kubectl get pv,pvc
NAME                              CAPACITY   ACCESS MODES   RECLAIM POLICY   STATUS   CLAIM                    STORAGECLASS   REASON   AGE
persistentvolume/fluid-imagenet   100Gi      RWX            Retain           Bound    default/fluid-imagenet                           1s
persistentvolume/nfs-imagenet     150Gi      ROX            Retain           Bound    default/nfs-imagenet     nfs                     16m

NAME                                   STATUS   VOLUME           CAPACITY   ACCESS MODES   STORAGECLASS   AGE
persistentvolumeclaim/fluid-imagenet   Bound    fluid-imagenet   100Gi      RWX                           0s
persistentvolumeclaim/nfs-imagenet     Bound    nfs-imagenet     150Gi      ROX            nfs            16m
</code></pre></div><h3 id="dawnbench-2"><a href="#dawnbench-2" class="header-anchor">#</a> Dawnbench</h3> <h4 id="_1x8-2"><a href="#_1x8-2" class="header-anchor">#</a> 1x8</h4> <div class="language-bash extra-class"><pre class="language-bash"><code>arena submit mpi <span class="token punctuation">\</span>
    --name horovod-resnet50-v2-1x8-fluid <span class="token punctuation">\</span>
    --gpus<span class="token operator">=</span><span class="token number">8</span> <span class="token punctuation">\</span>
    --workers<span class="token operator">=</span><span class="token number">1</span> <span class="token punctuation">\</span>
    --working-dir<span class="token operator">=</span>/horovod-demo/tensorflow-demo/ <span class="token punctuation">\</span>
    --data fluid-imagenet:/data <span class="token punctuation">\</span>
    -e <span class="token assign-left variable">DATA_DIR</span><span class="token operator">=</span>/data/nfs-imagenet/imagenet <span class="token punctuation">\</span>
    -e <span class="token assign-left variable">num_batch</span><span class="token operator">=</span><span class="token number">1000</span> <span class="token punctuation">\</span>
    -e <span class="token assign-left variable">datasets_num_private_threads</span><span class="token operator">=</span><span class="token number">8</span> <span class="token punctuation">\</span>
    --image<span class="token operator">=</span>registry.cn-hangzhou.aliyuncs.com/tensorflow-samples/horovod-benchmark-dawnbench-v2:0.18.1-tf1.14.0-torch1.2.0-mxnet1.5.0-py3.6 <span class="token punctuation">\</span>
    ./launch-example.sh <span class="token number">1</span> <span class="token number">8</span>
</code></pre></div><h4 id="_4x8-2"><a href="#_4x8-2" class="header-anchor">#</a> 4x8</h4> <div class="language-bash extra-class"><pre class="language-bash"><code>arena submit mpi <span class="token punctuation">\</span>
    --name horovod-resnet50-v2-4x8-fluid <span class="token punctuation">\</span>
    --gpus<span class="token operator">=</span><span class="token number">8</span> <span class="token punctuation">\</span>
    --workers<span class="token operator">=</span><span class="token number">4</span> <span class="token punctuation">\</span>
    --working-dir<span class="token operator">=</span>/horovod-demo/tensorflow-demo/ <span class="token punctuation">\</span>
    --data fluid-imagenet:/data <span class="token punctuation">\</span>
    -e <span class="token assign-left variable">DATA_DIR</span><span class="token operator">=</span>/data/nfs-imagenet/imagenet <span class="token punctuation">\</span>
    -e <span class="token assign-left variable">num_batch</span><span class="token operator">=</span><span class="token number">1000</span> <span class="token punctuation">\</span>
    -e <span class="token assign-left variable">datasets_num_private_threads</span><span class="token operator">=</span><span class="token number">8</span> <span class="token punctuation">\</span>
    --image<span class="token operator">=</span>registry.cn-hangzhou.aliyuncs.com/tensorflow-samples/horovod-benchmark-dawnbench-v2:0.18.1-tf1.14.0-torch1.2.0-mxnet1.5.0-py3.6 <span class="token punctuation">\</span>
    ./launch-example.sh <span class="token number">4</span> <span class="token number">8</span>
</code></pre></div><h2 id="experiment-results"><a href="#experiment-results" class="header-anchor">#</a> Experiment Results</h2> <h3 id="horovod-1x8"><a href="#horovod-1x8" class="header-anchor">#</a> horovod-1x8</h3> <table><thead><tr><th></th> <th>nfs</th> <th>fluid (cold)</th> <th>fluid (warm)</th></tr></thead> <tbody><tr><td>Training time</td> <td>3h49m10s</td> <td>3h50m40s</td> <td>3h34m15s</td></tr> <tr><td>Speed at the 1000 step(images/second)</td> <td>2400.8</td> <td>2378.4</td> <td>9327.6</td></tr> <tr><td>Speed at the last step(images/second)</td> <td>8696.8</td> <td>8692.8</td> <td>9301.6</td></tr> <tr><td>steps</td> <td>56300</td> <td>56300</td> <td>56300</td></tr> <tr><td>Accuracy @ 5</td> <td>0.9282</td> <td>0.9286</td> <td>0.9285</td></tr></tbody></table> <h3 id="horovod-4x8"><a href="#horovod-4x8" class="header-anchor">#</a> horovod-4x8</h3> <table><thead><tr><th></th> <th>nfs</th> <th>fluid (cold)</th> <th>fluid (warm)</th></tr></thead> <tbody><tr><td>Training time</td> <td>2h15m59s</td> <td>1h43m43s</td> <td>1h32m22s</td></tr> <tr><td>Speed at the 1000 step(images/second)</td> <td>3136</td> <td>8889.6</td> <td>20859.5</td></tr> <tr><td>Speed at the last step(images/second)</td> <td>15024</td> <td>20506.3</td> <td>21329</td></tr> <tr><td>steps</td> <td>14070</td> <td>14070</td> <td>14070</td></tr> <tr><td>Accuracy @ 5</td> <td>0.9228</td> <td>0.9204</td> <td>0.9243</td></tr></tbody></table> <h2 id="result-analysis"><a href="#result-analysis" class="header-anchor">#</a> Result analysis</h2> <p>From the test results, the Fluid acceleration effect on 1x8 has no obvious effect,
but in the scenario of 4x8, the effect is very obvious.
In warm data scenario, the training time can be shortened (135-92)/135 = 31%;
In cold data scenario, training time can be shortened (135-103) /135 = 23%.
This is because NFS bandwidth became a bottleneck under 4x8;
Fluid based on Alluxio provides distributed cache data reading capability for P2P data.</p></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/fluid/samples/" class="prev router-link-active">
        DEMO - Speed Up Accessing Remote Files
      </a></span> <span class="next"><a href="/fluid/samples/machinelearning.html">
        DEMO - Accelerate Machine Learning Training with Fluid
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/fluid/assets/js/app.f9e62644.js" defer></script><script src="/fluid/assets/js/2.81b06f56.js" defer></script><script src="/fluid/assets/js/36.27b2095a.js" defer></script>
  </body>
</html>
