(window.webpackJsonp=window.webpackJsonp||[]).push([[37],{395:function(a,t,e){"use strict";e.r(t);var s=e(19),r=Object(s.a)({},(function(){var a=this,t=a._self._c;return t("ContentSlotsDistributor",{attrs:{"slot-key":a.$parent.slotKey}},[t("h1",{attrs:{id:"demo-accelerate-pvc-with-fluid"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#demo-accelerate-pvc-with-fluid"}},[a._v("#")]),a._v(" DEMO - Accelerate PVC with Fluid")]),a._v(" "),t("p",[t("a",{attrs:{href:"https://fluid-imgs.oss-cn-shanghai.aliyuncs.com/public/video/accelerate_pvc.mp4",target:"_blank",rel:"noopener noreferrer"}},[t("img",{attrs:{src:"https://fluid-imgs.oss-cn-shanghai.aliyuncs.com/public/imgs/accelerate_pvc.jfif",alt:""}}),t("OutboundLink")],1)]),a._v(" "),t("h2",{attrs:{id:"test-scenario-resnet50-model-training"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#test-scenario-resnet50-model-training"}},[a._v("#")]),a._v(" Test scenario: ResNet50 model training")]),a._v(" "),t("ul",[t("li",[a._v("Machine： V100 x8")]),a._v(" "),t("li",[a._v("NFS Server：38037492dc-pol25.cn-shanghai.nas.aliyuncs.com")])]),a._v(" "),t("h2",{attrs:{id:"settings"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#settings"}},[a._v("#")]),a._v(" Settings")]),a._v(" "),t("h3",{attrs:{id:"hardware"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#hardware"}},[a._v("#")]),a._v(" Hardware")]),a._v(" "),t("table",[t("thead",[t("tr",[t("th",[a._v("Cluster")]),a._v(" "),t("th",[a._v("Alibaba Cloud Kubernetes. v1.16.9-aliyun.1")])])]),a._v(" "),t("tbody",[t("tr",[t("td",[a._v("ECS Instance")]),a._v(" "),t("td",[a._v("ECS   specifications：ecs.gn6v-c10g1.20xlarge"),t("br"),a._v("    CPU：82 cores")])]),a._v(" "),t("tr",[t("td",[a._v("Distributed Storage")]),a._v(" "),t("td",[a._v("NAS")])])])]),a._v(" "),t("h3",{attrs:{id:"software"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#software"}},[a._v("#")]),a._v(" Software")]),a._v(" "),t("p",[a._v("Software version: 0.18.1-tf1.14.0-torch1.2.0-mxnet1.5.0-py3.6")]),a._v(" "),t("h2",{attrs:{id:"prerequisites"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#prerequisites"}},[a._v("#")]),a._v(" Prerequisites")]),a._v(" "),t("ul",[t("li",[t("a",{attrs:{href:"https://github.com/fluid-cloudnative/fluid",target:"_blank",rel:"noopener noreferrer"}},[a._v("Fluid"),t("OutboundLink")],1),a._v(" (version >= 0.3.0)")]),a._v(" "),t("li",[t("a",{attrs:{href:"https://github.com/kubeflow/arena",target:"_blank",rel:"noopener noreferrer"}},[a._v("Arena"),t("OutboundLink")],1),a._v("（version >= 0.4.0）")]),a._v(" "),t("li",[t("a",{attrs:{href:"https://github.com/horovod/horovod",target:"_blank",rel:"noopener noreferrer"}},[a._v("Horovod"),t("OutboundLink")],1),a._v(" (version=0.18.1)")]),a._v(" "),t("li",[t("a",{attrs:{href:"https://github.com/tensorflow/benchmarks/tree/cnn_tf_v1.14_compatible",target:"_blank",rel:"noopener noreferrer"}},[a._v("Benchmark"),t("OutboundLink")],1)])]),a._v(" "),t("h2",{attrs:{id:"prepare-dataset"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#prepare-dataset"}},[a._v("#")]),a._v(" Prepare Dataset")]),a._v(" "),t("ol",[t("li",[a._v("Download")])]),a._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[a._v("$ "),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("wget")]),a._v(" http://imagenet-tar.oss-cn-shanghai.aliyuncs.com/imagenet.tar.gz\n")])])]),t("ol",{attrs:{start:"2"}},[t("li",[a._v("Unpack")])]),a._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[a._v("$ "),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("tar")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-I")]),a._v(" pigz "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-xvf")]),a._v(" imagenet.tar.gz\n")])])]),t("h2",{attrs:{id:"nfs-dawnbench"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#nfs-dawnbench"}},[a._v("#")]),a._v(" NFS dawnbench")]),a._v(" "),t("h3",{attrs:{id:"deploy-dataset"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#deploy-dataset"}},[a._v("#")]),a._v(" Deploy Dataset")]),a._v(" "),t("ol",[t("li",[t("p",[a._v("Export Dataset on Your NFS Server")])]),a._v(" "),t("li",[t("p",[a._v("Create Volume using Kubernetes")])])]),a._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[a._v("$ "),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("cat")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("<<")]),t("span",{pre:!0,attrs:{class:"token string"}},[a._v("EOF"),t("span",{pre:!0,attrs:{class:"token bash punctuation"}},[a._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),a._v(" nfs.yaml")]),a._v("\napiVersion: v1\nkind: PersistentVolume\nmetadata:\n  name: nfs-imagenet\nspec:\n  capacity:\n    storage: 150Gi\n  volumeMode: Filesystem\n  accessModes:\n  - ReadOnlyMany\n  persistentVolumeReclaimPolicy: Retain\n  storageClassName: nfs\n  mountOptions:\n  - vers=3\n  - nolock\n  - proto=tcp\n  - rsize=1048576\n  - wsize=1048576\n  - hard\n  - timeo=600\n  - retrans=2\n  - noresvport\n  - nfsvers=4.1\n  nfs:\n    path: <YOUR_PATH_TO_DATASET>\n    server: <YOUR_NFS_SERVER>\n---\napiVersion: v1\nkind: PersistentVolumeClaim\nmetadata:\n  name: nfs-imagenet\nspec:\n  accessModes:\n  - ReadOnlyMany\n  resources:\n    requests:\n      storage: 150Gi\n  storageClassName: nfs\nEOF")]),a._v("\n")])])]),t("blockquote",[t("p",[t("strong",[a._v("NOTE:")])]),a._v(" "),t("p",[a._v("Please replace "),t("code",[a._v("YOUR_PATH_TO_DATASET")]),a._v(" and "),t("code",[a._v("YOUR_NFS_SERVER")]),a._v("\nwith your own nfs server address and path to dataset.")])]),a._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[a._v("$ kubectl create "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-f")]),a._v(" nfs.yaml\n")])])]),t("ol",{attrs:{start:"3"}},[t("li",[a._v("Check Volume")])]),a._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[a._v("$ kubectl get pv,pvc\nNAME                            CAPACITY   ACCESS MODES   RECLAIM POLICY   STATUS   CLAIM                  STORAGECLASS   REASON   AGE\npersistentvolume/nfs-imagenet   150Gi      ROX            Retain           Bound    default/nfs-imagenet   nfs                     45s\n\nNAME                                 STATUS   VOLUME         CAPACITY   ACCESS MODES   STORAGECLASS   AGE\npersistentvolumeclaim/nfs-imagenet   Bound    nfs-imagenet   150Gi      ROX            nfs            45s\n")])])]),t("h3",{attrs:{id:"dawnbench"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#dawnbench"}},[a._v("#")]),a._v(" Dawnbench")]),a._v(" "),t("blockquote",[t("p",[a._v("NOTES:")]),a._v(" "),t("p",[t("code",[a._v("1x8")]),a._v(" means "),t("code",[a._v("1")]),a._v(" machine with "),t("code",[a._v("8")]),a._v(" GPU cards.")])]),a._v(" "),t("h4",{attrs:{id:"_1x8"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1x8"}},[a._v("#")]),a._v(" 1x8")]),a._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[a._v("arena submit mpi "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("\n    "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--name")]),a._v(" horovod-resnet50-v2-1x8-nfs "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("\n    "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--gpus")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("8")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("\n    "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--workers")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("1")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("\n    --working-dir"),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("/horovod-demo/tensorflow-demo/ "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("\n    "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--data")]),a._v(" nfs-imagenet:/data "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("\n    "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-e")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[a._v("DATA_DIR")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("/data/imagenet "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("\n    "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-e")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[a._v("num_batch")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("1000")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("\n    "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-e")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[a._v("datasets_num_private_threads")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("8")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("\n    "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--image")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("registry.cn-hangzhou.aliyuncs.com/tensorflow-samples/horovod-benchmark-dawnbench-v2:0.18.1-tf1.14.0-torch1.2.0-mxnet1.5.0-py3.6 "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("\n    ./launch-example.sh "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("1")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("8")]),a._v("\n")])])]),t("h4",{attrs:{id:"_4x8"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_4x8"}},[a._v("#")]),a._v(" 4x8")]),a._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[a._v("arena submit mpi "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("\n    "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--name")]),a._v(" horovod-resnet50-v2-4x8-nfs "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("\n    "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--gpus")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("8")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("\n    "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--workers")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("4")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("\n    --working-dir"),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("/horovod-demo/tensorflow-demo/ "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("\n    "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--data")]),a._v(" nfs-imagenet:/data "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("\n    "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-e")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[a._v("DATA_DIR")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("/data/imagenet "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("\n    "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-e")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[a._v("num_batch")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("1000")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("\n    "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-e")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[a._v("datasets_num_private_threads")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("8")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("\n    "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--image")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("registry.cn-hangzhou.aliyuncs.com/tensorflow-samples/horovod-benchmark-dawnbench-v2:0.18.1-tf1.14.0-torch1.2.0-mxnet1.5.0-py3.6 "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("\n    ./launch-example.sh "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("4")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("8")]),a._v("\n")])])]),t("blockquote",[t("p",[t("strong",[a._v("NOTE:")])]),a._v(" "),t("p",[a._v("If you find that nfs volume cannot be deleted,\nthis is because Arena will leave a launcher pod after training finished,\nand Kubernetes still thinks that volume is in using.")]),a._v(" "),t("p",[a._v("Just execute following command to force deleting volume:")]),a._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[a._v("$ kubectl patch pvc nfs-imagenet  "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-p")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[a._v('\'{"metadata":{"finalizers": []}}\'')]),a._v(" "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--type")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("merge\n")])])])]),a._v(" "),t("h2",{attrs:{id:"accelerate-pvc-with-fluid"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#accelerate-pvc-with-fluid"}},[a._v("#")]),a._v(" Accelerate PVC with Fluid")]),a._v(" "),t("h3",{attrs:{id:"deploy-dataset-2"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#deploy-dataset-2"}},[a._v("#")]),a._v(" Deploy Dataset")]),a._v(" "),t("ol",[t("li",[a._v("Follow Previous Steps to Create NFS Volume")]),a._v(" "),t("li",[a._v("Deploy Fluid to Accelerate NFS Volume")])]),a._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[a._v("$ "),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("cat")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("<<")]),t("span",{pre:!0,attrs:{class:"token string"}},[a._v("EOF"),t("span",{pre:!0,attrs:{class:"token bash punctuation"}},[a._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),a._v(" dataset.yaml")]),a._v('\napiVersion: data.fluid.io/v1alpha1\nkind: Dataset\nmetadata:\n  name: fluid-imagenet\nspec:\n  mounts:\n  - mountPoint: pvc://nfs-imagenet\n    name: nfs-imagenet\n  nodeAffinity:\n    required:\n      nodeSelectorTerms:\n        - matchExpressions:\n            - key: aliyun.accelerator/nvidia_name\n              operator: In\n              values:\n                - Tesla-V100-SXM2-16GB\n---\napiVersion: data.fluid.io/v1alpha1\nkind: AlluxioRuntime\nmetadata:\n  name: fluid-imagenet\nspec:\n  replicas: 4\n  data:\n    replicas: 1\n  tieredstore:\n    levels:\n      - mediumtype: SSD\n        path: /var/lib/docker/alluxio\n        quota: 150Gi\n        high: "0.99"\n        low: "0.8"\nEOF')]),a._v("\n")])])]),t("blockquote",[t("p",[t("strong",[a._v("NOTE:")])]),a._v(" "),t("ul",[t("li",[a._v("Please keep "),t("code",[a._v("spec.replicas")]),a._v(" consistent with the number of machines you are going to use for machine learning。")]),a._v(" "),t("li",[t("code",[a._v("nodeSelectorTerms")]),a._v(" is used to restrict scheduling on machines with V100 GPU only.")])])]),a._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[a._v("$ kubectl create "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-f")]),a._v(" dataset.yaml\n")])])]),t("ol",{attrs:{start:"3"}},[t("li",[a._v("Check Volume")])]),a._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[a._v("$ kubectl get pv,pvc\nNAME                              CAPACITY   ACCESS MODES   RECLAIM POLICY   STATUS   CLAIM                    STORAGECLASS   REASON   AGE\npersistentvolume/fluid-imagenet   100Gi      RWX            Retain           Bound    default/fluid-imagenet                           1s\npersistentvolume/nfs-imagenet     150Gi      ROX            Retain           Bound    default/nfs-imagenet     nfs                     16m\n\nNAME                                   STATUS   VOLUME           CAPACITY   ACCESS MODES   STORAGECLASS   AGE\npersistentvolumeclaim/fluid-imagenet   Bound    fluid-imagenet   100Gi      RWX                           0s\npersistentvolumeclaim/nfs-imagenet     Bound    nfs-imagenet     150Gi      ROX            nfs            16m\n")])])]),t("h3",{attrs:{id:"dawnbench-2"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#dawnbench-2"}},[a._v("#")]),a._v(" Dawnbench")]),a._v(" "),t("h4",{attrs:{id:"_1x8-2"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1x8-2"}},[a._v("#")]),a._v(" 1x8")]),a._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[a._v("arena submit mpi "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("\n    "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--name")]),a._v(" horovod-resnet50-v2-1x8-fluid "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("\n    "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--gpus")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("8")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("\n    "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--workers")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("1")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("\n    --working-dir"),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("/horovod-demo/tensorflow-demo/ "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("\n    "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--data")]),a._v(" fluid-imagenet:/data "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("\n    "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-e")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[a._v("DATA_DIR")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("/data/nfs-imagenet/imagenet "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("\n    "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-e")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[a._v("num_batch")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("1000")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("\n    "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-e")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[a._v("datasets_num_private_threads")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("8")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("\n    "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--image")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("registry.cn-hangzhou.aliyuncs.com/tensorflow-samples/horovod-benchmark-dawnbench-v2:0.18.1-tf1.14.0-torch1.2.0-mxnet1.5.0-py3.6 "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("\n    ./launch-example.sh "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("1")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("8")]),a._v("\n")])])]),t("h4",{attrs:{id:"_4x8-2"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_4x8-2"}},[a._v("#")]),a._v(" 4x8")]),a._v(" "),t("div",{staticClass:"language-bash extra-class"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[a._v("arena submit mpi "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("\n    "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--name")]),a._v(" horovod-resnet50-v2-4x8-fluid "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("\n    "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--gpus")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("8")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("\n    "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--workers")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("4")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("\n    --working-dir"),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("/horovod-demo/tensorflow-demo/ "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("\n    "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--data")]),a._v(" fluid-imagenet:/data "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("\n    "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-e")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[a._v("DATA_DIR")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("/data/nfs-imagenet/imagenet "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("\n    "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-e")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[a._v("num_batch")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("1000")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("\n    "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-e")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[a._v("datasets_num_private_threads")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("8")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("\n    "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--image")]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("registry.cn-hangzhou.aliyuncs.com/tensorflow-samples/horovod-benchmark-dawnbench-v2:0.18.1-tf1.14.0-torch1.2.0-mxnet1.5.0-py3.6 "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("\\")]),a._v("\n    ./launch-example.sh "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("4")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("8")]),a._v("\n")])])]),t("h2",{attrs:{id:"experiment-results"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#experiment-results"}},[a._v("#")]),a._v(" Experiment Results")]),a._v(" "),t("h3",{attrs:{id:"horovod-1x8"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#horovod-1x8"}},[a._v("#")]),a._v(" horovod-1x8")]),a._v(" "),t("table",[t("thead",[t("tr",[t("th"),a._v(" "),t("th",[a._v("nfs")]),a._v(" "),t("th",[a._v("fluid (cold)")]),a._v(" "),t("th",[a._v("fluid (warm)")])])]),a._v(" "),t("tbody",[t("tr",[t("td",[a._v("Training time")]),a._v(" "),t("td",[a._v("3h49m10s")]),a._v(" "),t("td",[a._v("3h50m40s")]),a._v(" "),t("td",[a._v("3h34m15s")])]),a._v(" "),t("tr",[t("td",[a._v("Speed at the 1000 step(images/second)")]),a._v(" "),t("td",[a._v("2400.8")]),a._v(" "),t("td",[a._v("2378.4")]),a._v(" "),t("td",[a._v("9327.6")])]),a._v(" "),t("tr",[t("td",[a._v("Speed at the last step(images/second)")]),a._v(" "),t("td",[a._v("8696.8")]),a._v(" "),t("td",[a._v("8692.8")]),a._v(" "),t("td",[a._v("9301.6")])]),a._v(" "),t("tr",[t("td",[a._v("steps")]),a._v(" "),t("td",[a._v("56300")]),a._v(" "),t("td",[a._v("56300")]),a._v(" "),t("td",[a._v("56300")])]),a._v(" "),t("tr",[t("td",[a._v("Accuracy @ 5")]),a._v(" "),t("td",[a._v("0.9282")]),a._v(" "),t("td",[a._v("0.9286")]),a._v(" "),t("td",[a._v("0.9285")])])])]),a._v(" "),t("h3",{attrs:{id:"horovod-4x8"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#horovod-4x8"}},[a._v("#")]),a._v(" horovod-4x8")]),a._v(" "),t("table",[t("thead",[t("tr",[t("th"),a._v(" "),t("th",[a._v("nfs")]),a._v(" "),t("th",[a._v("fluid (cold)")]),a._v(" "),t("th",[a._v("fluid (warm)")])])]),a._v(" "),t("tbody",[t("tr",[t("td",[a._v("Training time")]),a._v(" "),t("td",[a._v("2h15m59s")]),a._v(" "),t("td",[a._v("1h43m43s")]),a._v(" "),t("td",[a._v("1h32m22s")])]),a._v(" "),t("tr",[t("td",[a._v("Speed at the 1000 step(images/second)")]),a._v(" "),t("td",[a._v("3136")]),a._v(" "),t("td",[a._v("8889.6")]),a._v(" "),t("td",[a._v("20859.5")])]),a._v(" "),t("tr",[t("td",[a._v("Speed at the last step(images/second)")]),a._v(" "),t("td",[a._v("15024")]),a._v(" "),t("td",[a._v("20506.3")]),a._v(" "),t("td",[a._v("21329")])]),a._v(" "),t("tr",[t("td",[a._v("steps")]),a._v(" "),t("td",[a._v("14070")]),a._v(" "),t("td",[a._v("14070")]),a._v(" "),t("td",[a._v("14070")])]),a._v(" "),t("tr",[t("td",[a._v("Accuracy @ 5")]),a._v(" "),t("td",[a._v("0.9228")]),a._v(" "),t("td",[a._v("0.9204")]),a._v(" "),t("td",[a._v("0.9243")])])])]),a._v(" "),t("h2",{attrs:{id:"result-analysis"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#result-analysis"}},[a._v("#")]),a._v(" Result analysis")]),a._v(" "),t("p",[a._v("From the test results, the Fluid acceleration effect on 1x8 has no obvious effect,\nbut in the scenario of 4x8, the effect is very obvious.\nIn warm data scenario, the training time can be shortened (135-92)/135 = 31%;\nIn cold data scenario, training time can be shortened (135-103) /135 = 23%.\nThis is because NFS bandwidth became a bottleneck under 4x8;\nFluid based on Alluxio provides distributed cache data reading capability for P2P data.")])])}),[],!1,null,null,null);t.default=r.exports}}]);