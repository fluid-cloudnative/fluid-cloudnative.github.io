(window.webpackJsonp=window.webpackJsonp||[]).push([[76],{436:function(a,t,s){"use strict";s.r(t);var n=s(19),e=Object(n.a)({},(function(){var a=this,t=a._self._c;return t("ContentSlotsDistributor",{attrs:{"slot-key":a.$parent.slotKey}},[t("h1",{attrs:{id:"示例-hdfs-client文件访问加速"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#示例-hdfs-client文件访问加速"}},[a._v("#")]),a._v(" 示例 - HDFS Client文件访问加速")]),a._v(" "),t("p",[a._v("本文介绍如何使用HDFS Client，在Fluid中通过Alluxio协议访问远程文件，并借助Alluxio的文件缓存能力，实现访问远程文件加速。")]),a._v(" "),t("h2",{attrs:{id:"前提条件"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#前提条件"}},[a._v("#")]),a._v(" 前提条件")]),a._v(" "),t("p",[a._v("在运行该示例之前，请参考"),t("RouterLink",{attrs:{to:"/guide/get_started.html"}},[a._v("安装文档")]),a._v("完成安装，并检查Fluid各组件正常运行：")],1),a._v(" "),t("div",{staticClass:"language-shell extra-class"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[a._v("$ kubectl get pod "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-n")]),a._v(" fluid-system\nNAME                                  READY   STATUS    RESTARTS   AGE\nalluxioruntime-controller-5b64fdbbb-84pc6   "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("1")]),a._v("/1     Running   "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("0")]),a._v("          8h\ncsi-nodeplugin-fluid-fwgjh                  "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("2")]),a._v("/2     Running   "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("0")]),a._v("          8h\ncsi-nodeplugin-fluid-ll8bq                  "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("2")]),a._v("/2     Running   "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("0")]),a._v("          8h\ndataset-controller-5b7848dbbb-n44dj         "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("1")]),a._v("/1     Running   "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("0")]),a._v("          8h\n")])])]),t("h2",{attrs:{id:"新建工作环境"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#新建工作环境"}},[a._v("#")]),a._v(" 新建工作环境")]),a._v(" "),t("div",{staticClass:"language-shell extra-class"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[a._v("$ "),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("mkdir")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("<")]),a._v("any-path"),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),a._v("/hdfs\n$ "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[a._v("cd")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("<")]),a._v("any-path"),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),a._v("/hdfs\n")])])]),t("h2",{attrs:{id:"运行示例"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#运行示例"}},[a._v("#")]),a._v(" 运行示例")]),a._v(" "),t("p",[t("strong",[a._v("查看待创建的Dataset资源对象")])]),a._v(" "),t("div",{staticClass:"language-shell extra-class"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[a._v("$ cat"),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("<<")]),t("span",{pre:!0,attrs:{class:"token string"}},[a._v("EOF"),t("span",{pre:!0,attrs:{class:"token bash punctuation"}},[a._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),a._v("dataset.yaml")]),a._v("\napiVersion: data.fluid.io/v1alpha1\nkind: Dataset\nmetadata:\n  name: hadoop\nspec:\n  mounts:\n    - mountPoint: https://mirrors.tuna.tsinghua.edu.cn/apache/hadoop/core/current/\n      name: hadoop\nEOF")]),a._v("\n")])])]),t("p",[a._v("在这里，我们将要创建一个kind为"),t("code",[a._v("Dataset")]),a._v("的资源对象(Resource object)。"),t("code",[a._v("Dataset")]),a._v("是Fluid所定义的一个Custom Resource Definition(CRD)，该CRD被用来告知Fluid在哪里可以找到你所需要的数据。Fluid将该CRD对象中定义的"),t("code",[a._v("mountPoint")]),a._v("属性挂载到Alluxio之上，因此该属性可以是任何合法的能够被Alluxio识别的UFS地址。在本示例中，为了简单，我们使用"),t("a",{attrs:{href:"https://docs.alluxio.io/os/user/stable/cn/ufs/WEB.html",target:"_blank",rel:"noopener noreferrer"}},[a._v("WebUFS"),t("OutboundLink")],1),a._v("进行演示。")]),a._v(" "),t("p",[t("strong",[a._v("创建Dataset资源对象")])]),a._v(" "),t("div",{staticClass:"language-shell extra-class"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[a._v("$ kubectl create "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-f")]),a._v(" dataset.yaml\ndataset.data.fluid.io/hadoop created\n")])])]),t("p",[t("strong",[a._v("查看Dataset资源对象状态")])]),a._v(" "),t("div",{staticClass:"language-shell extra-class"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[a._v("$ kubectl get dataset hadoop\nNAME     UFS TOTAL SIZE   CACHED   CACHE CAPACITY   CACHED PERCENTAGE   PHASE      AGE\nhadoop                                                                  NotBound   1m\n")])])]),t("p",[a._v("如上所示，"),t("code",[a._v("status")]),a._v("中的"),t("code",[a._v("phase")]),a._v("属性值为"),t("code",[a._v("NotBound")]),a._v("，这意味着该"),t("code",[a._v("Dataset")]),a._v("资源对象目前还未与任何"),t("code",[a._v("AlluxioRuntime")]),a._v("资源对象绑定，接下来，我们将创建一个"),t("code",[a._v("AlluxioRuntime")]),a._v("资源对象。")]),a._v(" "),t("p",[t("strong",[a._v("查看待创建的AlluxioRuntime资源对象")])]),a._v(" "),t("div",{staticClass:"language-shell extra-class"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[a._v("$ cat"),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("<<")]),a._v("EOF "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),a._v("runtime.yaml\napiVersion: data.fluid.io/v1alpha1\nkind: AlluxioRuntime\nmetadata:\n  name: hadoop\nspec:\n  replicas: "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("2")]),a._v("\n  tieredstore:\n    levels:\n      - mediumtype: MEM\n        path: /dev/shm\n        quota: 2Gi\n        high: "),t("span",{pre:!0,attrs:{class:"token string"}},[a._v('"0.95"')]),a._v("\n        low: "),t("span",{pre:!0,attrs:{class:"token string"}},[a._v('"0.7"')]),a._v("\n")])])]),t("p",[t("strong",[a._v("创建AlluxioRuntime资源对象")])]),a._v(" "),t("div",{staticClass:"language-shell extra-class"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[a._v("$ kubectl apply "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-f")]),a._v(" runtime.yaml\nalluxioruntime.data.fluid.io/hadoop created\n")])])]),t("p",[t("strong",[a._v("检查AlluxioRuntime资源对象状态")])]),a._v(" "),t("p",[t("code",[a._v("AlluxioRuntime")]),a._v("是另一个Fluid定义的CRD。一个"),t("code",[a._v("AlluxioRuntime")]),a._v("资源对象描述了在Kubernetes集群中运行一个Alluxio实例所需要的配置信息。")]),a._v(" "),t("p",[a._v("等待一段时间，让AlluxioRuntime资源对象中的各个组件得以顺利启动，你会看到类似以下状态：")]),a._v(" "),t("div",{staticClass:"language-shell extra-class"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[a._v("$ hdfs kubectl get pods\nNAME                            READY   STATUS    RESTARTS   AGE\nhadoop-fuse-749fs               "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("1")]),a._v("/1     Running   "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("0")]),a._v("          64s\nhadoop-fuse-khdrb               "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("1")]),a._v("/1     Running   "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("0")]),a._v("          64s\nhadoop-master-0                 "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("2")]),a._v("/2     Running   "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("0")]),a._v("          106s\nhadoop-worker-cn9fg             "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("2")]),a._v("/2     Running   "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("0")]),a._v("          64s\nhadoop-worker-tlldq             "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("2")]),a._v("/2     Running   "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("0")]),a._v("          64s\n")])])]),t("div",{staticClass:"language-shell extra-class"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[a._v("$ kubectl get alluxioruntime hadoop\nNAME     MASTER PHASE   WORKER PHASE   FUSE PHASE   AGE\nhadoop   Ready          Ready          Ready        116s\n")])])]),t("p",[a._v("然后，再查看Dataset状态，发现已经与AlluxioRuntime绑定。")]),a._v(" "),t("div",{staticClass:"language-shell extra-class"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[a._v("$ kubectl get dataset hadoop\nNAME     UFS TOTAL SIZE   CACHED   CACHE CAPACITY   CACHED PERCENTAGE   PHASE   AGE\nhadoop   "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("390")]),a._v(".2MiB         0B       4GiB             "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("0")]),a._v("%                  Bound   55m\n")])])]),t("p",[a._v("Dataset资源对象准备完成后（即与Alluxio实例绑定后），与该资源对象关联的PV, PVC已经由Fluid生成，应用可以通过该PVC完成远程文件在Pod中的挂载，并通过挂载目录实现远程文件访问")]),a._v(" "),t("h2",{attrs:{id:"通过hdfs-client访问文件"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#通过hdfs-client访问文件"}},[a._v("#")]),a._v(" 通过HDFS Client访问文件")]),a._v(" "),t("p",[t("strong",[a._v("准备测试程序")])]),a._v(" "),t("p",[a._v("本例采用HDFS Java Client访问文件，在编写客户端代码时需要引入以下依赖项")]),a._v(" "),t("div",{staticClass:"language-xml extra-class"},[t("pre",{pre:!0,attrs:{class:"language-xml"}},[t("code",[t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("<")]),a._v("dependency")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(">")])]),a._v("\n  "),t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("<")]),a._v("groupId")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(">")])]),a._v("org.apache.hadoop"),t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("</")]),a._v("groupId")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(">")])]),a._v("\n  "),t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("<")]),a._v("artifactId")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(">")])]),a._v("hadoop-client"),t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("</")]),a._v("artifactId")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(">")])]),a._v("\n  "),t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("<")]),a._v("version")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(">")])]),a._v("${hadoop.version}"),t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("</")]),a._v("version")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(">")])]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("</")]),a._v("dependency")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(">")])]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("<")]),a._v("dependency")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(">")])]),a._v("\n  "),t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("<")]),a._v("groupId")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(">")])]),a._v("org.apache.hadoop"),t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("</")]),a._v("groupId")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(">")])]),a._v("\n  "),t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("<")]),a._v("artifactId")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(">")])]),a._v("hadoop-hdfs"),t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("</")]),a._v("artifactId")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(">")])]),a._v("\n  "),t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("<")]),a._v("version")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(">")])]),a._v("${hadoop.version}"),t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("</")]),a._v("version")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(">")])]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("</")]),a._v("dependency")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(">")])]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("<")]),a._v("dependency")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(">")])]),a._v("\n  "),t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("<")]),a._v("groupId")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(">")])]),a._v("org.alluxio"),t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("</")]),a._v("groupId")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(">")])]),a._v("\n  "),t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("<")]),a._v("artifactId")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(">")])]),a._v("alluxio-core-client"),t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("</")]),a._v("artifactId")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(">")])]),a._v("\n  "),t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("<")]),a._v("version")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(">")])]),a._v("${alluxio.version}"),t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("</")]),a._v("version")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(">")])]),a._v("\n  "),t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("<")]),a._v("type")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(">")])]),a._v("pom"),t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("</")]),a._v("type")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(">")])]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("</")]),a._v("dependency")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(">")])]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("<")]),a._v("dependency")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(">")])]),a._v("\n  "),t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("<")]),a._v("groupId")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(">")])]),a._v("org.alluxio"),t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("</")]),a._v("groupId")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(">")])]),a._v("\n  "),t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("<")]),a._v("artifactId")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(">")])]),a._v("alluxio-core-client-hdfs"),t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("</")]),a._v("artifactId")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(">")])]),a._v("\n  "),t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("<")]),a._v("version")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(">")])]),a._v("${alluxio.version}"),t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("</")]),a._v("version")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(">")])]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("</")]),a._v("dependency")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(">")])]),a._v("\n")])])]),t("p",[a._v("同时要在core-site.xml中添加alluxio的配置，详情和故障排查可参考"),t("a",{attrs:{href:"https://docs.alluxio.io/os/user/stable/en/compute/Hadoop-MapReduce.html",target:"_blank",rel:"noopener noreferrer"}},[a._v("Running Hadoop MapReduce on Alluxio"),t("OutboundLink")],1),a._v("。")]),a._v(" "),t("div",{staticClass:"language-xml extra-class"},[t("pre",{pre:!0,attrs:{class:"language-xml"}},[t("code",[t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("<")]),a._v("property")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(">")])]),a._v("\n  "),t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("<")]),a._v("name")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(">")])]),a._v("fs.alluxio.impl"),t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("</")]),a._v("name")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(">")])]),a._v("\n  "),t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("<")]),a._v("value")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(">")])]),a._v("alluxio.hadoop.FileSystem"),t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("</")]),a._v("value")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(">")])]),a._v("\n  "),t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("<")]),a._v("description")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(">")])]),a._v("The Alluxio FileSystem"),t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("</")]),a._v("description")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(">")])]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token tag"}},[t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("</")]),a._v("property")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(">")])]),a._v("\n")])])]),t("p",[a._v("在通过HDFS Client访问文件时，需要指定HDFS Server地址")]),a._v(" "),t("div",{staticClass:"language-java extra-class"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("final")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("String")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token constant"}},[a._v("HDFS_URL")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[a._v('"alluxio://hadoop-master-0.default.svc.cluster.local:"')]),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("+")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("System")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("getenv")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[a._v('"HADOOP_PORT"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("+")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[a._v('"/hadoop"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("Configuration")]),a._v(" conf "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("new")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("Configuration")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("FileSystem")]),a._v(" fs "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token class-name"}},[a._v("FileSystem")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("get")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),t("span",{pre:!0,attrs:{class:"token constant"}},[a._v("URI")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("create")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),t("span",{pre:!0,attrs:{class:"token constant"}},[a._v("HDFS_URL")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v(" conf"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n")])])]),t("p",[a._v("注意这里的HDFS_URL域名规则为:")]),a._v(" "),t("div",{staticClass:"language-shell extra-class"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[a._v("alluxio://"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("HCFS URL"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v("/"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("DATASET_NAME"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v("\n")])])]),t("p",[a._v("其中DATASET_NAME为前面创建的Dataset名称，本例中为hadoop。而Endpoint的获得完全可以通过如下命令获得HCFS(Hadoop Compatible FileSystem) URL")]),a._v(" "),t("div",{staticClass:"language-shell extra-class"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[a._v(" kubectl get datasets.data.fluid.io "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-owide")]),a._v("\nNAME    UFS TOTAL SIZE   CACHED   CACHE CAPACITY   CACHED PERCENTAGE   PHASE   HCFS URL                                 AGE\nhbase   "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("443")]),a._v(".49MiB        "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("0")]),a._v(".00B    "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("4")]),a._v(".00GiB          "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("0.0")]),a._v("%                Bound   alluxio://hbase-master-0.default:19998   97s\n")])])]),t("p",[a._v("完整的测试代码可参考"),t("a",{attrs:{href:"../../../samples/hdfs"}},[a._v("samples/hdfs")]),a._v("。我们把测试代码制作成镜像，方便接下来的测试，镜像地址为registry.cn-hangzhou.aliyuncs.com/qiulingwei/fluid-hdfs-demo:1.2.0")]),a._v(" "),t("p",[t("strong",[a._v("查看待创建的测试作业")])]),a._v(" "),t("div",{staticClass:"language-shell extra-class"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[a._v("$ cat"),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("<<")]),t("span",{pre:!0,attrs:{class:"token string"}},[a._v("EOF"),t("span",{pre:!0,attrs:{class:"token bash punctuation"}},[a._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v(">")]),a._v("app.yaml")]),a._v('\napiVersion: batch/v1\nkind: Job\nmetadata:\n  name: fluid-hdfs-demo\nspec:\n  template:\n    spec:\n      restartPolicy: OnFailure\n      containers:\n        - name: fluid-hdfs-demo\n          image: registry.cn-hangzhou.aliyuncs.com/qiulingwei/fluid-hdfs-demo:1.3.0\n          imagePullPolicy: Always\n          env:\n          - name: HADOOP_PORT\n            value: "19998"\nEOF')]),a._v("\n")])])]),t("p",[a._v("此处，需要将环境变量中的19998替换为刚刚查询得到的HCFS(Hadoop Compatible FileSystem) URL中实际的端口")]),a._v(" "),t("p",[t("strong",[a._v("启动测试作业")])]),a._v(" "),t("div",{staticClass:"language-shell extra-class"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[a._v("$ kubectl apply "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-f")]),a._v(" app.yaml\njob.batch/fluid-hdfs-demo created\n")])])]),t("p",[a._v("在测试程序中我们先遍历Dataset查看有哪些文件，然后把这些文件复制到本地，查看访问远程文件的加速效果。")]),a._v(" "),t("p",[a._v("等待一段时间,待该作业运行完成,作业的运行状态可通过以下命令查看:")]),a._v(" "),t("div",{staticClass:"language-shell extra-class"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[a._v("$ kubectl get pods\nNAME                            READY   STATUS      RESTARTS   AGE\nfluid-hdfs-demo-8q9b7           "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("0")]),a._v("/1     Completed   "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("0")]),a._v("          14m\n")])])]),t("p",[t("strong",[a._v("查看任务执行时间")])]),a._v(" "),t("div",{staticClass:"language-shell extra-class"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[a._v("$ kubectl logs fluid-hdfs-demo-8q9b7\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("## RELEASENOTES.md")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("## hadoop-3.1.3-src.tar.gz")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("## CHANGES.md")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("## hadoop-3.1.3-site.tar.gz")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("## hadoop-3.1.3-rat.txt")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("## hadoop-3.1.3.tar.gz")]),a._v("\ncopy directory cost:67520ms\n")])])]),t("p",[a._v("第一次执行作业，耗时67秒多时间。")]),a._v(" "),t("p",[t("strong",[a._v("查看Dataset资源对象状态")])]),a._v(" "),t("div",{staticClass:"language-shell extra-class"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[a._v("$ kubectl get dataset hadoop\nNAME     UFS TOTAL SIZE   CACHED     CACHE CAPACITY   CACHED PERCENTAGE   PHASE   AGE\nhadoop   "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("390")]),a._v(".2MiB         "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("388")]),a._v(".4MiB   4GiB             "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("99")]),a._v("%                 Bound   88m\n")])])]),t("p",[a._v("可以看到所有远程文件已经被缓存在Alluxio中了。")]),a._v(" "),t("p",[t("strong",[a._v("再次启动测试作业")])]),a._v(" "),t("div",{staticClass:"language-shell extra-class"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[a._v("$ kubectl delete "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-f")]),a._v(" app.yaml\n$ kubectl create "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-f")]),a._v(" app.yaml\n")])])]),t("p",[a._v("由于远程文件都已经被缓存，这次作业耗时大大减少。")]),a._v(" "),t("div",{staticClass:"language-shell extra-class"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[a._v("$ kubectl logs fluid-hdfs-demo-pxt45\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("## RELEASENOTES.md")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("## hadoop-3.1.3-src.tar.gz")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("## CHANGES.md")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("## hadoop-3.1.3-site.tar.gz")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("## hadoop-3.1.3-rat.txt")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("## hadoop-3.1.3.tar.gz")]),a._v("\ncopy directory cost:1300ms\n")])])]),t("p",[a._v("可以看到第二次作业，同样的文件访问，仅耗时1.3秒。")]),a._v(" "),t("p",[a._v("这种大幅度的加速效果归因于Alluxio所提供的强大的缓存能力，这种缓存能力意味着，只要你访问某个远程文件一次，该文件就会被缓存在Alluxio中，你的所有接下来的重复访问都不再需要进行远程文件读取，而是从Alluxio中直接获取数据，因此对于数据的访问加速也就不难解释了。")]),a._v(" "),t("h2",{attrs:{id:"环境清理"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#环境清理"}},[a._v("#")]),a._v(" 环境清理")]),a._v(" "),t("div",{staticClass:"language-shell extra-class"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[a._v("$ kubectl delete "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-f")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[a._v(".")]),a._v("\n")])])])])}),[],!1,null,null,null);t.default=e.exports}}]);