(window.webpackJsonp=window.webpackJsonp||[]).push([[41],{399:function(t,a,s){"use strict";s.r(a);var e=s(19),r=Object(e.a)({},(function(){var t=this,a=t._self._c;return a("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[a("h1",{attrs:{id:"demo-accelerate-hostpath-with-fluid"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#demo-accelerate-hostpath-with-fluid"}},[t._v("#")]),t._v(" DEMO - Accelerate Hostpath with Fluid")]),t._v(" "),a("h2",{attrs:{id:"test-scenario-resnet50-model-training"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#test-scenario-resnet50-model-training"}},[t._v("#")]),t._v(" Test scenario: ResNet50 model training")]),t._v(" "),a("ul",[a("li",[t._v("Machine： V100 x8")]),t._v(" "),a("li",[t._v("NFS Server：38037492dc-pol25.cn-shanghai.nas.aliyuncs.com")])]),t._v(" "),a("h2",{attrs:{id:"settings"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#settings"}},[t._v("#")]),t._v(" Settings")]),t._v(" "),a("h3",{attrs:{id:"hardware"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#hardware"}},[t._v("#")]),t._v(" Hardware")]),t._v(" "),a("table",[a("thead",[a("tr",[a("th",[t._v("Cluster")]),t._v(" "),a("th",[t._v("Alibaba Cloud Kubernetes. v1.16.9-aliyun.1")])])]),t._v(" "),a("tbody",[a("tr",[a("td",[t._v("ECS Instance")]),t._v(" "),a("td",[t._v("ECS   specifications：ecs.gn6v-c10g1.20xlarge"),a("br"),t._v("    CPU：82 cores")])]),t._v(" "),a("tr",[a("td",[t._v("Distributed Storage")]),t._v(" "),a("td",[t._v("NAS")])])])]),t._v(" "),a("h3",{attrs:{id:"software"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#software"}},[t._v("#")]),t._v(" Software")]),t._v(" "),a("p",[t._v("Software version: 0.18.1-tf1.14.0-torch1.2.0-mxnet1.5.0-py3.6")]),t._v(" "),a("h2",{attrs:{id:"prerequisites"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#prerequisites"}},[t._v("#")]),t._v(" Prerequisites")]),t._v(" "),a("ul",[a("li",[a("a",{attrs:{href:"https://github.com/fluid-cloudnative/fluid",target:"_blank",rel:"noopener noreferrer"}},[t._v("Fluid"),a("OutboundLink")],1),t._v(" (version >= 0.3.0)")]),t._v(" "),a("li",[a("a",{attrs:{href:"https://github.com/kubeflow/arena",target:"_blank",rel:"noopener noreferrer"}},[t._v("Arena"),a("OutboundLink")],1),t._v("（version >= 0.4.0）")]),t._v(" "),a("li",[a("a",{attrs:{href:"https://github.com/horovod/horovod",target:"_blank",rel:"noopener noreferrer"}},[t._v("Horovod"),a("OutboundLink")],1),t._v(" (version=0.18.1)")]),t._v(" "),a("li",[a("a",{attrs:{href:"https://github.com/tensorflow/benchmarks/tree/cnn_tf_v1.14_compatible",target:"_blank",rel:"noopener noreferrer"}},[t._v("Benchmark"),a("OutboundLink")],1)])]),t._v(" "),a("h2",{attrs:{id:"known-constraints"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#known-constraints"}},[t._v("#")]),t._v(" Known constraints")]),t._v(" "),a("ul",[a("li",[t._v("It is not recommended to use the host directory to achieve mount, because this method relies on kubernetes' unexpected mount point maintenance method, which is actually not reliable and may cause data inconsistency.")])]),t._v(" "),a("h2",{attrs:{id:"prepare-dataset"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#prepare-dataset"}},[t._v("#")]),t._v(" Prepare Dataset")]),t._v(" "),a("ol",[a("li",[t._v("Download")])]),t._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[t._v("$ "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("wget")]),t._v(" http://imagenet-tar.oss-cn-shanghai.aliyuncs.com/imagenet.tar.gz\n")])])]),a("ol",{attrs:{start:"2"}},[a("li",[t._v("Unpack")])]),t._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[t._v("$ "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("tar")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-I")]),t._v(" pigz "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-xvf")]),t._v(" imagenet.tar.gz\n")])])]),a("h2",{attrs:{id:"nfs-dawnbench"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#nfs-dawnbench"}},[t._v("#")]),t._v(" NFS dawnbench")]),t._v(" "),a("h3",{attrs:{id:"deploy-dataset"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#deploy-dataset"}},[t._v("#")]),t._v(" Deploy Dataset")]),t._v(" "),a("ol",[a("li",[a("p",[t._v("Export Dataset on Your NFS Server")])]),t._v(" "),a("li",[a("p",[t._v("Mount NFS to Host Directory")])])]),t._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[t._v("$ "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("sudo")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("mount")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-t")]),t._v(" nfs "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-o")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("vers")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("3")]),t._v(",nolock,proto"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("tcp,rsize"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1048576")]),t._v(",wsize"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1048576")]),t._v(",hard,timeo"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("600")]),t._v(",retrans"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),t._v(",noresvport "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("YOUR_NFS_SERVER"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(":"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("YOUR_PATH_TO_DATASET"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" /mnt/nfs-imagenet\n")])])]),a("ol",{attrs:{start:"3"}},[a("li",[t._v("Check Volume")])]),t._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[t._v("$ "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("mount")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("grep")]),t._v(" nfs\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("YOUR_NFS_SERVER"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(":"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("<")]),t._v("YOUR_PATH_TO_DATASET"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(">")]),t._v(" on /mnt/nfs-imagenet "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[t._v("type")]),t._v(" nfs "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("rw,relatime,vers"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("3")]),t._v(",rsize"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1048576")]),t._v(",wsize"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1048576")]),t._v(",namlen"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("255")]),t._v(",hard,nolock,noresvport,proto"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("tcp,timeo"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("600")]),t._v(",retrans"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),t._v(",sec"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("sys,mountaddr"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("192.168")]),t._v(".1.28,mountvers"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("3")]),t._v(",mountport"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("2049")]),t._v(",mountproto"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("tcp,local_lock"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("all,addr"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("192.168")]),t._v(".1.28"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),a("blockquote",[a("p",[a("strong",[t._v("NOTE:")])]),t._v(" "),a("p",[t._v("修改上述命令中的"),a("code",[t._v("<YOUR_NFS_SERVER>")]),t._v("和"),a("code",[t._v("<YOUR_PATH_TO_DATASET>")]),t._v("为您的nfs server地址和挂载路径。")])]),t._v(" "),a("h3",{attrs:{id:"dawnbench"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#dawnbench"}},[t._v("#")]),t._v(" Dawnbench")]),t._v(" "),a("h4",{attrs:{id:"_1x8"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1x8"}},[t._v("#")]),t._v(" 1x8")]),t._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[t._v("arena submit mpijob "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("--name")]),t._v(" horovod-v2-nfs-hostpath-1x8-093000 "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("--gpus")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("8")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("--workers")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("\n--working-dir"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("/horovod-demo/tensorflow-demo/ "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("\n--data-dir /mnt/nfs-imagenet:/data "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-e")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("DATA_DIR")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("/data/imagenet "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-e")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("num_batch")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1000")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-e")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("datasets_num_private_threads")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("8")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("--image")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("registry.cn-hangzhou.aliyuncs.com/tensorflow-samples/horovod-benchmark-dawnbench-v2:0.18.1-tf1.14.0-torch1.2.0-mxnet1.5.0-py3.6 "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("\n./launch-example.sh "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("8")]),t._v("\n")])])]),a("h4",{attrs:{id:"_4x8"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4x8"}},[t._v("#")]),t._v(" 4x8")]),t._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[t._v("arena submit mpi "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("--name")]),t._v(" horovod-v2-nfs-hostpath-4x8-092921 "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("--gpus")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("8")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("--workers")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("4")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v(" \n--working-dir"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("/horovod-demo/tensorflow-demo/ "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v(" \n--data-dir /mnt/nfs-imagenet:/data "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-e")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("DATA_DIR")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("/data/imagenet "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-e")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("num_batch")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1000")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-e")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[t._v("datasets_num_private_threads")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("8")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("--image")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("registry.cn-hangzhou.aliyuncs.com/tensorflow-samples/horovod-benchmark-dawnbench-v2:0.18.1-tf1.14.0-torch1.2.0-mxnet1.5.0-py3.6 "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("\\")]),t._v("\n./launch-example.sh "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("4")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("8")]),t._v("\n")])])]),a("h2",{attrs:{id:"accelerate-hostpath-with-fluid"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#accelerate-hostpath-with-fluid"}},[t._v("#")]),t._v(" Accelerate Hostpath with Fluid")]),t._v(" "),a("h3",{attrs:{id:"deploy-dataset-2"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#deploy-dataset-2"}},[t._v("#")]),t._v(" Deploy Dataset")]),t._v(" "),a("ol",[a("li",[t._v("Follow Previous Steps to Create NFS Volume")]),t._v(" "),a("li",[t._v("Deploy Fluid to Accelerate Hostpath")])]),t._v(" "),a("div",{staticClass:"language-yaml extra-class"},[a("pre",{pre:!0,attrs:{class:"language-yaml"}},[a("code",[t._v("$ cat <<EOF "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")]),t._v(" dataset.yaml\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("apiVersion")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" data.fluid.io/v1alpha1\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("kind")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" Dataset\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("metadata")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" imagenet\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("spec")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("mounts")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("mountPoint")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" local"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("///mnt/nfs"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("imagenet\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" imagenet\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("nodeAffinity")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("required")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("nodeSelectorTerms")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("matchExpressions")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n            "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("key")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" aliyun.accelerator/nvidia_name\n              "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("operator")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" In\n              "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("values")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n                "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" Tesla"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("V100"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("SXM2"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("16GB\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("---")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("apiVersion")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" data.fluid.io/v1alpha1\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("kind")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" AlluxioRuntime\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("metadata")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" imagenet\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("spec")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("replicas")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("4")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("data")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("replicas")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("tieredstore")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("levels")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("mediumtype")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" MEM\n        "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("path")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" /alluxio/ram \n        "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("quota")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" 50Gi\n        "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("high")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"0.99"')]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("low")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"0.8"')]),t._v("\nEOF\n")])])]),a("blockquote",[a("p",[a("strong",[t._v("NOTE:")])]),t._v(" "),a("ul",[a("li",[a("code",[t._v("mounts.mountPoint")]),t._v("通过"),a("code",[t._v("local://")]),t._v("的前缀来指明要挂载的主机目录(e.g. "),a("code",[t._v("/mnt/nfs-imagenet")]),t._v(")")]),t._v(" "),a("li",[a("code",[t._v("spec.replicas")]),t._v("和dawnbench测试的worker数量保持一致。比如：单机八卡为1，四机八卡为4")]),t._v(" "),a("li",[a("code",[t._v("nodeSelectorTerms")]),t._v("作用是限制在有V100显卡的机器上部署数据集，此处应根据实验环境具体调节")])])]),t._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[t._v("$ kubectl create "),a("span",{pre:!0,attrs:{class:"token parameter variable"}},[t._v("-f")]),t._v(" dataset.yaml\n")])])]),a("ol",{attrs:{start:"3"}},[a("li",[t._v("Check Volume")])]),t._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[t._v("$ kubectl get pv,pvc\nNAME                        CAPACITY   ACCESS MODES   RECLAIM POLICY   STATUS   CLAIM              STORAGECLASS   REASON   AGE\npersistentvolume/imagenet   100Gi      RWX            Retain           Bound    default/imagenet                           3h28m\n\nNAME                             STATUS   VOLUME     CAPACITY   ACCESS MODES   STORAGECLASS   AGE\npersistentvolumeclaim/imagenet   Bound    imagenet   100Gi      RWX                           3h28m\n")])])]),a("h3",{attrs:{id:"dawnbench-2"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#dawnbench-2"}},[t._v("#")]),t._v(" dawnbench")]),t._v(" "),a("h4",{attrs:{id:"_1x8-2"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1x8-2"}},[t._v("#")]),t._v(" 1x8")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("arena submit mpi \\\n--name horovod-v2-nfs-fluid-1x8-093009 \\\n--gpus=8 \\\n--workers=1 \\\n--working-dir=/horovod-demo/tensorflow-demo/ \\\n--data imagenet:/data \\\n-e DATA_DIR=/data/imagenet/imagenet \\\n-e num_batch=1000 \\\n-e datasets_num_private_threads=8 \\\n--image=registry.cn-hangzhou.aliyuncs.com/tensorflow-samples/horovod-benchmark-dawnbench-v2:0.18.1-tf1.14.0-torch1.2.0-mxnet1.5.0-py3.6 \\\n./launch-example.sh 1 8\n")])])]),a("h4",{attrs:{id:"_4x8-2"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4x8-2"}},[t._v("#")]),t._v(" 4x8")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("arena submit mpi \\\n--name horovod-v2-nfs-fluid-4x8-092910 \\\n--gpus=8 \\\n--workers=4 \\\n--working-dir=/horovod-demo/tensorflow-demo/ \\\n--data imagenet:/data \\\n-e DATA_DIR=/data/imagenet/imagenet \\\n-e num_batch=1000 \\\n-e datasets_num_private_threads=8 \\\n--image=registry.cn-hangzhou.aliyuncs.com/tensorflow-samples/horovod-benchmark-dawnbench-v2:0.18.1-tf1.14.0-torch1.2.0-mxnet1.5.0-py3.6 \\\n./launch-example.sh 4 8\n")])])]),a("h2",{attrs:{id:"experiment-results"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#experiment-results"}},[t._v("#")]),t._v(" Experiment Results")]),t._v(" "),a("h3",{attrs:{id:"horovod-1x8"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#horovod-1x8"}},[t._v("#")]),t._v(" horovod-1x8")]),t._v(" "),a("table",[a("thead",[a("tr",[a("th"),t._v(" "),a("th",[t._v("nfs-hostpath")]),t._v(" "),a("th",[t._v("fluid (cold)")]),t._v(" "),a("th",[t._v("fluid (warm)")])])]),t._v(" "),a("tbody",[a("tr",[a("td",[t._v("raining time")]),t._v(" "),a("td",[t._v("4h20m36s")]),t._v(" "),a("td",[t._v("4h21m56s")]),t._v(" "),a("td",[t._v("4h2m16s")])]),t._v(" "),a("tr",[a("td",[t._v("Speed at the 1000 step(images/second)")]),t._v(" "),a("td",[t._v("2426.4")]),t._v(" "),a("td",[t._v("2467.2")]),t._v(" "),a("td",[t._v("8959.7")])]),t._v(" "),a("tr",[a("td",[t._v("Speed at the last step(images/second)")]),t._v(" "),a("td",[t._v("8218.1")]),t._v(" "),a("td",[t._v("8219.8")]),t._v(" "),a("td",[t._v("8275.8")])]),t._v(" "),a("tr",[a("td",[t._v("steps")]),t._v(" "),a("td",[t._v("56300")]),t._v(" "),a("td",[t._v("56300")]),t._v(" "),a("td",[t._v("56300")])]),t._v(" "),a("tr",[a("td",[t._v("Accuracy @ 5")]),t._v(" "),a("td",[t._v("0.9280")]),t._v(" "),a("td",[t._v("0.9288")]),t._v(" "),a("td",[t._v("0.9291")])])])]),t._v(" "),a("h3",{attrs:{id:"horovod-4x8"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#horovod-4x8"}},[t._v("#")]),t._v(" horovod-4x8")]),t._v(" "),a("table",[a("thead",[a("tr",[a("th"),t._v(" "),a("th",[t._v("nfs-hostpath")]),t._v(" "),a("th",[t._v("fluid (cold)")]),t._v(" "),a("th",[t._v("fluid (warm)")])])]),t._v(" "),a("tbody",[a("tr",[a("td",[t._v("训练时间")]),t._v(" "),a("td",[t._v("2h9m21s")]),t._v(" "),a("td",[t._v("1h40m15s")]),t._v(" "),a("td",[t._v("1h29m55s")])]),t._v(" "),a("tr",[a("td",[t._v("Speed at the 1000 step(images/second)")]),t._v(" "),a("td",[t._v("3219.2")]),t._v(" "),a("td",[t._v("11067.2")]),t._v(" "),a("td",[t._v("21951.3")])]),t._v(" "),a("tr",[a("td",[t._v("Speed at the last step(images/second)")]),t._v(" "),a("td",[t._v("15855.7")]),t._v(" "),a("td",[t._v("20964.4")]),t._v(" "),a("td",[t._v("21869.8")])]),t._v(" "),a("tr",[a("td",[t._v("steps")]),t._v(" "),a("td",[t._v("14070")]),t._v(" "),a("td",[t._v("14070")]),t._v(" "),a("td",[t._v("14070")])]),t._v(" "),a("tr",[a("td",[t._v("Accuracy @ 5")]),t._v(" "),a("td",[t._v("0.9227")]),t._v(" "),a("td",[t._v("0.9232")]),t._v(" "),a("td",[t._v("0.9228")])])])]),t._v(" "),a("h2",{attrs:{id:"结果分析"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#结果分析"}},[t._v("#")]),t._v(" 结果分析")]),t._v(" "),a("p",[t._v("From the test results, the Fluid acceleration effect on 1x8 has no obvious effect,\nbut in the scenario of 4x8, the effect is very obvious.\nIn warm data scenario, the training time can be shortened (135-92)/135 = 31%;\nIn cold data scenario, training time can be shortened (135-103) /135 = 23%.\nThis is because NFS bandwidth became a bottleneck under 4x8;\nFluid based on Alluxio provides distributed cache data reading capability for P2P data.")])])}),[],!1,null,null,null);a.default=r.exports}}]);