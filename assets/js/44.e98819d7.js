(window.webpackJsonp=window.webpackJsonp||[]).push([[44],{401:function(t,a,s){"use strict";s.r(a);var e=s(19),n=Object(e.a)({},(function(){var t=this,a=t._self._c;return a("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[a("h1",{attrs:{id:"example-using-fluid-to-access-non-root-user-s-data"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#example-using-fluid-to-access-non-root-user-s-data"}},[t._v("#")]),t._v(" Example - Using Fluid to access non-root user's data")]),t._v(" "),a("p",[t._v("If the user data could only be access by specific uid, Runtime's 'RunAs' parameter should be set to let specific user run distributed data caching engine, to access underlying data.")]),t._v(" "),a("p",[t._v("This document demonstrates the above features with a simple example.")]),t._v(" "),a("h2",{attrs:{id:"prerequisites"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#prerequisites"}},[t._v("#")]),t._v(" Prerequisites")]),t._v(" "),a("ul",[a("li",[a("a",{attrs:{href:"https://github.com/fluid-cloudnative/fluid",target:"_blank",rel:"noopener noreferrer"}},[t._v("Fluid"),a("OutboundLink")],1),t._v("(version >= 0.3.0)")])]),t._v(" "),a("p",[t._v("Please refer to "),a("a",{attrs:{href:"https://github.com/fluid-cloudnative/fluid/blob/master/docs/zh/userguide/install.md",target:"_blank",rel:"noopener noreferrer"}},[t._v("Fluid installation documentation"),a("OutboundLink")],1),t._v(" to complete installation.")]),t._v(" "),a("h2",{attrs:{id:"running-example"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#running-example"}},[t._v("#")]),t._v(" Running Example")]),t._v(" "),a("p",[a("strong",[t._v("Create a non-root user")])]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("$ groupadd -g 1201 fluid-user-1 && \\\nuseradd -u 1201 -g fluid-user-1 fluid-user-1\n")])])]),a("p",[t._v("The above command creates a non-root user"),a("code",[t._v("fluid-user-1")])]),t._v(" "),a("p",[a("strong",[t._v("Create a directory that belongs to the user")])]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v('$ mkdir -p /mnt/nonroot/user1_data && \\\necho "This is fluid-user-1\'s data" > /mnt/nonroot/user1_data/data1 && \\\nchown -R fluid-user-1:fluid-user-1 /mnt/nonroot/user1_data && \\\nchmod -R 0750 /mnt/nonroot/user1_data\n')])])]),a("p",[t._v("The above command creates a directory "),a("code",[t._v("user1_data")]),t._v(" belonging to "),a("code",[t._v("fluid-user-1")]),t._v(" in the "),a("code",[t._v("/mnt/nonroot")]),t._v(" directory, We will use the "),a("code",[t._v("data1")]),t._v(" file in the "),a("code",[t._v("user1_data")]),t._v(" directory to represent the data owned by "),a("code",[t._v("fluid-user-1")])]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("$ ls -ltR /mnt/nonroot\n")])])]),a("p",[t._v("Using the above command, you will see the following results")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("/mnt/nonroot/:\ntotal 4\ndrwxr-x--- 2 fluid-user-1 fluid-user-1 4096 9月  27 16:45 user1_data\n\n/mnt/nonroot/user1_data:\ntotal 4\n-rwxr-x--- 1 fluid-user-1 fluid-user-1 28 9月  27 16:45 data1\n")])])]),a("p",[a("strong",[t._v("Create Dataset and AlluxioRuntime resource object")])]),t._v(" "),a("div",{staticClass:"language-yaml extra-class"},[a("pre",{pre:!0,attrs:{class:"language-yaml"}},[a("code",[t._v("$ cat<<EOF "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")]),t._v("dataset.yaml\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("apiVersion")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" data.fluid.io/v1alpha1\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("kind")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" Dataset\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("metadata")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" nonroot\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("spec")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("mounts")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# Specify the directory you just created as the mount point")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("mountPoint")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" local"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("///mnt/nonroot/\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" nonroot\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# Ensure that the data cache is placed at the node where the /mnt/nonroot directory exists")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("nodeAffinity")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("required")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("nodeSelectorTerms")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("matchExpressions")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n            "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("key")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" nonroot\n              "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("operator")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" In\n              "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("values")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n                "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"true"')]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("---")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("apiVersion")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" data.fluid.io/v1alpha1\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("kind")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" AlluxioRuntime\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("metadata")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" nonroot\n"),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("spec")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("replicas")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("tieredstore")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("levels")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("mediumtype")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" SSD\n        "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("path")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" /var/lib/docker/alluxio\n        "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("quota")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" 2Gi\n        "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("high")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"0.95"')]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("low")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"0.7"')]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# start Alluxio as the fluid-user-1 user")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("runAs")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("uid")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1201")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("gid")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1201")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("user")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" fluid"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("user"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("group")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" fluid"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("user"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),a("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("fuse")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("args")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" fuse\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("fuse"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("opts=kernel_cache"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("ro"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("max_read=131072"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("attr_timeout=7200"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("entry_timeout=7200"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("max_readahead=0\nEOF\n")])])]),a("p",[t._v("In the above yaml configuration file, we will mount the directory we just created (/mnt/nonroot ') in the same way as the Fluid host directory. For more information about Fluid mount host directory, please refer to "),a("RouterLink",{attrs:{to:"/samples/hostpath.html"}},[t._v("example - use Fluid to accelerate host directory")])],1),t._v(" "),a("p",[t._v("In addition, in "),a("code",[t._v("spec.runAs")]),t._v(" we have set user information such as "),a("code",[t._v("uid")]),t._v(", which means that we are going to start the caching engine as a "),a("code",[t._v("fluid-user-1")]),t._v(" user to provide distributed caching capabilities")]),t._v(" "),a("p",[a("strong",[t._v("Log into the Application")])]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("$ kubectl exec -it nginx -- bash\n")])])]),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("$ id\n")])])]),a("p",[t._v("Using the above command, you will see the following results:")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("uid=1201 gid=1201 groups=1201\n")])])]),a("p",[t._v("This indicates that we started the application as a user with "),a("code",[t._v("uid")]),t._v(" of 1201")]),t._v(" "),a("p",[a("strong",[t._v("Access Data")])]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("$ ls -ltR /data\n")])])]),a("p",[t._v("Using the above command, you will see the following results:")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("/data/:\ntotal 1\ndrwxr-xr-x 1 root root 1 Sep 27 08:45 nonroot\n\n/data/nonroot:\ntotal 1\ndrwxr-x--- 1 1201 1201 1 Sep 27 08:45 user1_data\n\n/data/nonroot/user1_data:\ntotal 1\n-rwxr-x--- 1 1201 1201 28 Sep 27 08:45 data1\n")])])]),a("p",[t._v("As you can see, Fluid exposes data belonging to a non-root user to applications that require it in the manner of "),a("strong",[t._v("passthrough")]),t._v(", and the file information for the user's data does not change")]),t._v(" "),a("p",[t._v("Of course, the user is free to access the data:")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("$ cat /data/nonroot/user1_data/data1\n")])])]),a("p",[t._v("Using the above command, you will see the following results:")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("This is fluid-user-1's data\n")])])]),a("h2",{attrs:{id:"environment-cleanup"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#environment-cleanup"}},[t._v("#")]),t._v(" Environment Cleanup")]),t._v(" "),a("div",{staticClass:"language- extra-class"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[t._v("$ kubectl delete -f .\n$ rm -rf /mnt/nonroot\n$ userdel fluid-user-1\n")])])])])}),[],!1,null,null,null);a.default=n.exports}}]);